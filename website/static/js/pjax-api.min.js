/*! pjax-api v3.30.0 https://github.com/falsandtru/pjax-api | (c) 2012, falsandtru | (Apache-2.0 AND MPL-2.0) License */
require=function(){return function e(t,n,r){function i(o,c){if(!n[o]){if(!t[o]){var u="function"==typeof require&&require;if(!c&&u)return u(o,!0);if(s)return s(o,!0);var a=new Error("Cannot find module '"+o+"'");throw a.code="MODULE_NOT_FOUND",a}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){return i(t[o][1][e]||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}}()({1:[function(e,t,n){},{}],2:[function(e,t,n){arguments[4][1][0].apply(n,arguments)},{dup:1}],3:[function(e,t,n){arguments[4][1][0].apply(n,arguments)},{dup:1}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./global"),i=e("./type"),s=e("./concat"),{Object:o}=r.global;function c(e,t=function(e){switch(i.type(e)){case"Array":return[];case"Object":return e instanceof o?{}:o.create(null);default:return e}}){return function(n,...r){let s=i.isPrimitive(n);for(const o of r){const r=i.isPrimitive(o);if(r)n=o,s=r;else{s&&(n=t(o),s=r);for(const t in o)o.hasOwnProperty&&!o.hasOwnProperty(t)||e(t,n,o)}}return n}}n.assign=c((e,t,n)=>t[e]=n[e]),n.clone=c((e,t,r)=>{switch(i.type(r[e])){case"Array":return t[e]=n.clone([],r[e]);case"Object":switch(i.type(t[e])){case"Object":return t[e]=n.clone(r[e]instanceof o?{}:o.create(null),r[e]);default:return t[e]=r[e]}default:return t[e]=r[e]}}),n.extend=c((e,t,r)=>{switch(i.type(r[e])){case"Array":return t[e]=n.extend([],r[e]);case"Object":switch(i.type(t[e])){case"Object":return t[e]=n.extend(t[e],r[e]);default:return t[e]=n.extend(r[e]instanceof o?{}:o.create(null),r[e])}default:return t[e]=r[e]}}),n.merge=c((e,t,r)=>{switch(i.type(r[e])){case"Array":switch(i.type(t[e])){case"Array":return t[e]=s.concat(t[e],r[e]);default:return t[e]=n.merge([],r[e])}case"Object":switch(i.type(t[e])){case"Object":return t[e]=n.merge(t[e],r[e]);default:return t[e]=n.merge(r[e]instanceof o?{}:o.create(null),r[e])}default:return t[e]=r[e]}}),n.template=c},{"./concat":10,"./global":18,"./type":86}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./global"),i=e("./assign"),s=e("./equal"),{Map:o}=r.global;n.Cache=class{constructor(e,t=(()=>void 0),n={}){if(this.size=e,this.callback=t,this.settings={ignore:{delete:!1,clear:!1},data:{stats:[[],[]],entries:[]}},e>0==0)throw new Error("Spica: Cache: Cache size must be greater than 0.");i.extend(this.settings,n);const{stats:r,entries:s}=this.settings.data,c=r[1].slice(0,e),u=r[0].slice(0,e-c.length);this.stats={LRU:u,LFU:c},this.store=new o(s);for(const e of[...r[1],...r[0]].slice(c.length+u.length))this.store.delete(e);if(this.store.size!==c.length+u.length)throw new Error("Spica: Cache: Size of stats and entries is not matched.");if(![...c,...u].every(e=>this.store.has(e)))throw new Error("Spica: Cache: Keys of stats and entries is not matched.")}put(e,t,n=!0){if(!n&&this.store.has(e))return this.store.set(e,t),!0;if(this.access(e))return this.store.set(e,t),!0;const{LRU:r,LFU:i}=this.stats;if(r.length+i.length===this.size&&r.length<i.length){const e=i.pop(),t=this.store.get(e);this.store.delete(e),this.callback(e,t)}if(r.unshift(e),this.store.set(e,t),r.length+i.length>this.size){const e=r.pop(),t=this.store.get(e);this.store.delete(e),this.callback(e,t)}return!1}set(e,t,n){return this.put(e,t,n),t}get(e,t=!0){return t?(this.access(e),this.store.get(e)):this.store.get(e)}has(e){return this.store.has(e)}delete(e){if(!this.store.has(e))return!1;const{LRU:t,LFU:n}=this.stats;for(const r of[n,t]){const t=s.findIndex(e,r);if(-1===t)continue;const n=this.store.get(e);return this.store.delete(r.splice(t,1)[0]),!!this.settings.ignore.delete||(this.callback(e,n),!0)}return!1}clear(){const e=this.store;if(this.store=new o,this.stats={LRU:[],LFU:[]},!this.settings.ignore.clear)for(const t of e.keys())this.callback(t,e.get(t))}[Symbol.iterator](){return this.store[Symbol.iterator]()}export(){return{stats:[this.stats.LRU.slice(),this.stats.LFU.slice()],entries:[...this]}}inspect(){const{LRU:e,LFU:t}=this.stats;return[e.slice(),t.slice()]}access(e){return this.accessLFU(e)||this.accessLRU(e)}accessLRU(e){if(!this.store.has(e))return!1;const{LRU:t}=this.stats,n=s.findIndex(e,t);if(-1===n)return!1;const{LFU:r}=this.stats;return r.unshift(...t.splice(n,1)),!0}accessLFU(e){if(!this.store.has(e))return!1;const{LFU:t}=this.stats,n=s.findIndex(e,t);return-1!==n&&(t.unshift(...t.splice(n,1)),!0)}}},{"./assign":4,"./equal":14,"./global":18}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./global"),i=e("./promise"),s=e("./exception"),o=e("./monad/maybe"),c=e("./monad/either"),{Object:u,Set:a}=r.global;class l{constructor(e){this.resolve=e,this.alive=!0,this.canceled=!1,this.listeners=new a}}const d=Symbol.for("spica/cancellation::internal");n.Cancellation=class extends i.AtomicPromise{constructor(e=[]){var t;super(e=>t=e),this.register=(e=>{return this[d].canceled?(t(this[d].reason),()=>void 0):this[d].alive?(this[d].listeners.add(t),()=>this[d].alive?void this[d].listeners.delete(t):void 0):()=>void 0;function t(t){try{e(t)}catch(t){s.causeAsyncException(t)}}}),this.cancel=(e=>{if(this[d].alive){this[d].alive=!1,this[d].canceled=!0,this[d].reason=e,this[d].resolve(this[d].reason),u.freeze(this[d].listeners),u.freeze(this);for(const t of this[d].listeners)t(e)}}),this.close=(e=>{this[d].alive&&(this[d].alive=!1,this[d].resolve(i.AtomicPromise.reject(e)),u.freeze(this[d].listeners),u.freeze(this))}),this.promise=(e=>this[d].canceled?i.AtomicPromise.reject(this[d].reason):i.AtomicPromise.resolve(e)),this.maybe=(e=>o.Just(e).bind(e=>this[d].canceled?o.Nothing:o.Just(e))),this.either=(e=>c.Right(e).bind(e=>this[d].canceled?c.Left(this[d].reason):c.Right(e))),this[d]=new l(t);for(const t of e)t.register(this.cancel)}static get[Symbol.species](){return i.AtomicPromise}get canceled(){return this[d].canceled}}},{"./exception":15,"./global":18,"./monad/either":24,"./monad/maybe":28,"./promise":80}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./exception");let i=[];n.tick=function(e){i.push(e),1===i.length&&s.then(o)};const s=Promise.resolve();function o(){const e=function(){const e=i;return i=[],e}();for(;;)try{for(;e.length>0;)e.shift()();return}catch(e){r.causeAsyncException(e);continue}}},{"./exception":15}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./global"),i=e("./promise");var s=e("./clock.tick");n.tick=s.tick;const{setTimeout:o}=r.global;n.clock=Promise.resolve(void 0),n.wait=function(e){return 0===e?i.AtomicPromise.resolve(n.clock):new i.AtomicPromise(t=>void o(t,e))},n.never=new class e extends i.AtomicPromise{static get[Symbol.species](){return e}constructor(){super(()=>void 0)}then(){return super.then()}catch(){return super.then()}finally(){return super.then()}}},{"./clock.tick":7,"./global":18,"./promise":80}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.compose=function(e,...t){return t.reduce((e,t)=>(Object.getOwnPropertyNames(t.prototype).filter(t=>!(t in e.prototype)).forEach(n=>e.prototype[n]=t.prototype[n]),Object.getOwnPropertyNames(t).filter(t=>!(t in e)).forEach(n=>e[n]=t[n]),e),e)}},{}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.concat=function(e,t){return e.push(...t),e}},{}],11:[function(e,t,n){"use strict";var r,i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function c(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,c)}u((r=r.apply(e,t||[])).next())})},s=this&&this.__await||function(e){return this instanceof s?(this.v=e,this):new s(e)},o=this&&this.__asyncGenerator||function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),o=[];return r={},c("next"),c("throw"),c("return"),r[Symbol.asyncIterator]=function(){return this},r;function c(e){i[e]&&(r[e]=function(t){return new Promise(function(n,r){o.push([e,t,n,r])>1||u(e,t)})})}function u(e,t){try{(n=i[e](t)).value instanceof s?Promise.resolve(n.value.v).then(a,l):d(o[0][2],n)}catch(e){d(o[0][3],e)}var n}function a(e){u("next",e)}function l(e){u("throw",e)}function d(e,t){e(t),o.shift(),o.length&&u(o[0][0],o[0][1])}};Object.defineProperty(n,"__esModule",{value:!0});const c=e("./global"),u=e("./promise"),a=e("./future"),l=e("./assign"),d=e("./clock"),h=e("./exception"),f=e("./noop"),{Object:p,Error:m}=c.global,v=Symbol.for("spica/Coroutine.alive"),y=Symbol.for("spica/Coroutine.init"),b=Symbol.for("spica/Coroutine.exit"),w=Symbol.for("spica/Coroutine.terminate"),g=Symbol.for("spica/Coroutine.port");class q{constructor(e){this.alive=!0,this.state=new a.AtomicFuture,this.resume=new a.AtomicFuture,this.result=new a.AtomicFuture,this.msgs=[],this.settings={autorun:!0,size:0,interval:0,resume:()=>void 0,trigger:void 0},l.extend(this.settings,e),this.result.finally(()=>{for(;;)try{for(;this.msgs.length>0;){const[,e]=this.msgs.shift();e(u.AtomicPromise.reject(new m("Spica: Coroutine: Canceled.")))}return}catch(e){h.causeAsyncException(e);continue}})}}const S=Symbol.for("spica/coroutine::internal");class _ extends u.AtomicPromise{constructor(e,t={}){var n;if(super(e=>n=e),this[r]=new x(this),this[S]=new q(t),n(this[S].result),this[_.init]=(()=>i(this,void 0,void 0,function*(){let t=f.noop;try{if(this[_.init]=f.noop,!this[S].alive)return;const n=()=>this[S].msgs.length>0?([,t]=this[S].msgs.shift())[0]:this[S].resume.then(n),r=e.call(this);let i=0;for(;this[S].alive;){++i;const[e]=1===i?[void 0]:yield u.AtomicPromise.all([0===this[S].settings.size?void 0:n(),u.AtomicPromise.all([this[S].settings.resume(),this[S].settings.interval>0?d.wait(this[S].settings.interval):void 0])]);if(!this[S].alive)break;const{value:s,done:o}=yield r.next(e);if(!this[S].alive)break;if(o){const e=yield s;if(!this[S].alive)break;return this[S].alive=!1,this[S].state.bind({value:void 0,done:o}),this[S].result.bind(e),void t({value:e,done:o})}{const e=this[S].state;this[S].state=new a.AtomicFuture,e.bind({value:s,done:o}),t({value:s,done:o});continue}}t(u.AtomicPromise.reject(new m("Spica: Coroutine: Canceled.")))}catch(e){t(u.AtomicPromise.reject(e)),this[_.terminate](e)}})),void 0!==this[S].settings.trigger)for(const e of Array().concat(this[S].settings.trigger)){if(e in this)continue;const t=p.getOwnPropertyDescriptor(this,e)||{value:this[e],enumerable:!0,configurable:!0,writable:!0};p.defineProperty(this,e,{set(n){p.defineProperty(this,e,Object.assign(Object.assign({},t),{value:n})),this[y]()},get(){return this[e]},enumerable:!0,configurable:!0})}this[S].settings.autorun&&d.tick(()=>void this[_.init]())}static get[Symbol.species](){return u.AtomicPromise}get[v](){return this[S].alive}[b](e){this[S].alive&&u.AtomicPromise.resolve(e).then(e=>{this[S].alive&&(this[S].alive=!1,this[S].state.bind({value:void 0,done:!0}),this[S].result.bind(e))},e=>{this[S].alive&&(this[S].alive=!1,this[S].state.bind({value:void 0,done:!0}),this[S].result.bind(u.AtomicPromise.reject(e)))})}[w](e){return this[b](u.AtomicPromise.reject(e))}[Symbol.asyncIterator](){return o(this,arguments,function*(){for(;this[S].alive;){const{value:e}=yield s(this[S].state);if(!this[S].alive)break;yield yield s(e)}return yield s(this.then(()=>void 0))})}}n.Coroutine=_,r=g,_.alive=v,_.init=y,_.exit=b,_.terminate=w,_.port=g;class x{constructor(e){this.co=e}recv(){return this.co[S].state.then(({value:e,done:t})=>t?this.co.then(e=>({value:e,done:t})):{value:e,done:t})}send(e){if(!this.co[S].alive)return u.AtomicPromise.reject(new m("Spica: Coroutine: Canceled."));const t=new a.AtomicFuture;for(this.co[S].msgs.push([e,t.bind]),this.co[S].resume.bind(),this.co[S].resume=new a.AtomicFuture;this.co[S].msgs.length>this.co[S].settings.size;){const[,e]=this.co[S].msgs.shift();e(u.AtomicPromise.reject(new m("Spica: Coroutine: Overflowed.")))}return t.then()}connect(e){return i(this,void 0,void 0,function*(){const t=e.call(this.co);let n;for(;;){const{value:e,done:r}=yield t.next(n);if(r)return e;n=(yield this.send(e)).value}})}}n.isCoroutine=function(e){return"object"==typeof e&&!!e&&"symbol"==typeof e.constructor.exit&&"function"==typeof e[e.constructor.exit]&&"symbol"==typeof e.constructor.terminate&&"function"==typeof e[e.constructor.terminate]&&"symbol"==typeof e.constructor.port&&"object"==typeof e[e.constructor.port]}},{"./assign":4,"./clock":8,"./exception":15,"./future":17,"./global":18,"./noop":78,"./promise":80}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.curry=(e=>(function e(t,n){return n.length>=t.length?t(...n):(...r)=>e(t,[...n,...r])})(e,[]))},{}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}(e("./monad/either"))},{"./monad/either":24}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.findIndex=function(e,t){const n=e!=e;for(let r=0;r<t.length;++r){const i=t[r];if(n?i!=i:i===e)return r}return-1}},{}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.causeAsyncException=function(e){Promise.reject(e)}},{}],16:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./curry");n.flip=function(e){return r.curry((t,n)=>e.length>1?e(n,t):e(n)(t))}},{"./curry":12}],17:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./promise");n.Future=class extends Promise{constructor(e=!0){let t,n=!0;super(r=>t=(t=>{if(!n&&!e)return this.then();if(!n)throw new Error("Spica: Future: Cannot rebind a value.");return n=!1,r(t),this.then()})),this.bind=t}static get[Symbol.species](){return Promise}};n.AtomicFuture=class extends r.AtomicPromise{constructor(e=!0){let t,n=!0;super(r=>t=(t=>{if(!n&&!e)return this.then();if(!n)throw new Error("Spica: AtomicFuture: Cannot rebind a value.");return n=!1,r(t),this.then()})),this.bind=t}static get[Symbol.species](){return r.AtomicPromise}}},{"./promise":80}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.global="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||this,n.default=n.global,n.global.global=n.global},{}],19:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.HNil=new class{constructor(){this.NIL}push(e){return new r(e,this)}extend(e){return this.push(e())}tuple(){return[]}};class r{constructor(e,t){this.head=e,this.tail=t,this.CONS}push(e){return new r(e,this)}walk(e){return e(this.head),this.tail}modify(e){return this.tail.push(e(this.head))}extend(e){return this.push(e(this.head))}compact(e){return this.tail.modify(t=>e(this.head,t))}reverse(){return this.tuple().reverse()}tuple(){const e=this.tail.tuple();return e.unshift(this.head),e}}},{}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}(e("./monad/maybe"))},{"./monad/maybe":28}],21:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.memoize=function(e,t=new Map){return n=>t.has(n)?t.get(n):void t.set(n,e(n))||t.get(n)}},{}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./functor"),i=e("../curry");class s extends r.Functor{}n.Applicative=s,function(e){e.ap=function e(t,n){return n?t.bind(e=>n.fmap(i.curry(e))):n=>e(t,n)}}(s=n.Applicative||(n.Applicative={}))},{"../curry":12,"./functor":25}],23:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./monad"),i=e("../promise");class s extends r.Monad{constructor(e){super(e),this.EITHER}fmap(e){return this.bind(t=>new c(e(t)))}ap(e){return s.ap(this,e)}bind(e){return new s(()=>{const t=this.evaluate();if(t instanceof o)return t;if(t instanceof c)return e(t.extract());if(t instanceof s)return t.bind(e);throw new TypeError(`Spica: Either: Invalid monad value.\n\t${t}`)})}join(){return this.bind(e=>e)}extract(e,t){return t?this.fmap(t).extract(e):this.evaluate().extract(e)}static do(e){const t=e();let n;for(;;){const{value:e,done:r}=t.next(n);if(r)return e;const i=e.extract(()=>void 0,e=>[e]);if(!i)return e;n=i[0]}}}n.Either=s,function(e){function t(e){return new c(e)}e.pure=t,e.Return=t,e.sequence=function(t){return t instanceof e?t.extract(e=>i.AtomicPromise.resolve(new o(e)),t=>i.AtomicPromise.resolve(t).then(e.Return)):t.reduce((e,t)=>e.bind(e=>t.fmap(t=>[...e,t])),e.Return([]))}}(s=n.Either||(n.Either={}));class o extends s{constructor(e){super(u),this.a=e,this.LEFT}bind(e){return this}extract(e){if(!e)throw this.a;return e(this.a)}}n.Left=o;class c extends s{constructor(e){super(u),this.b=e,this.RIGHT}bind(e){return new s(()=>e(this.extract()))}extract(e,t){return t?t(this.b):this.b}}function u(){throw new Error("Spica: Either: Invalid thunk call.")}n.Right=c},{"../promise":80,"./monad":29}],24:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./either.impl");n.Either=class extends r.Either{constructor(){super(()=>void 0)}},n.Left=function(e){return new r.Left(e)},n.Right=function(e){return new r.Right(e)}},{"./either.impl":23}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./lazy");class i extends r.Lazy{}n.Functor=i,function(e){e.fmap=function(e,t){return t?e.fmap(t):t=>e.fmap(t)}}(i=n.Functor||(n.Functor={}))},{"./lazy":26}],26:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.Lazy=class{constructor(e){this.thunk=e}evaluate(){return this.memory_=this.memory_||this.thunk()}}},{}],27:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./monadplus"),i=e("../promise");class s extends r.MonadPlus{constructor(e){super(e),this.MAYBE}fmap(e){return this.bind(t=>new o(e(t)))}ap(e){return s.ap(this,e)}bind(e){return new s(()=>{const t=this.evaluate();if(t instanceof o)return e(t.extract());if(t instanceof c)return t;if(t instanceof s)return t.bind(e);throw new TypeError(`Spica: Maybe: Invalid monad value.\n\t${t}`)})}guard(e){return e?this:s.mzero}join(){return this.bind(e=>e)}extract(e,t){return t?this.fmap(t).extract(e):this.evaluate().extract(e)}static do(e){const t=e();let n;for(;;){const{value:e,done:r}=t.next(n);if(r)return e;const i=e.extract(()=>void 0,e=>[e]);if(!i)return e;n=i[0]}}}n.Maybe=s,function(e){function t(e){return new o(e)}e.pure=t,e.Return=t,e.sequence=function(t){return t instanceof e?t.extract(()=>i.AtomicPromise.resolve(e.mzero),t=>i.AtomicPromise.resolve(t).then(e.Return)):t.reduce((e,t)=>e.bind(e=>t.fmap(t=>[...e,t])),e.Return([]))}}(s=n.Maybe||(n.Maybe={}));class o extends s{constructor(e){super(u),this.a=e,this.JUST}bind(e){return new s(()=>e(this.extract()))}extract(e,t){return t?t(this.a):this.a}}n.Just=o;class c extends s{constructor(){super(u),this.NOTHING}bind(e){return this}extract(e){if(!e)throw void 0;return e()}}function u(){throw new Error("Spica: Maybe: Invalid thunk call.")}n.Nothing=c,function(e){e.mzero=new c,e.mplus=function(t,n){return new e(()=>t.fmap(()=>t).extract(()=>n))}}(s=n.Maybe||(n.Maybe={}))},{"../promise":80,"./monadplus":30}],28:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./maybe.impl");n.Maybe=class extends r.Maybe{constructor(){super(()=>void 0)}},n.Just=function(e){return new r.Just(e)},n.Nothing=r.Maybe.mzero},{"./maybe.impl":27}],29:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./applicative");class i extends r.Applicative{}n.Monad=i,function(e){e.bind=function e(t,n){return n?t.bind(n):n=>e(t,n)}}(i=n.Monad||(n.Monad={}))},{"./applicative":22}],30:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./monad");class i extends r.Monad{}n.MonadPlus=i,i=n.MonadPlus||(n.MonadPlus={})},{"./monad":29}],31:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./sequence/core");n.Sequence=r.Sequence;const i=e("./sequence/member/static/resume"),s=e("./sequence/member/static/from"),o=e("./sequence/member/static/cycle"),c=e("./sequence/member/static/random"),u=e("./sequence/member/static/concat"),a=e("./sequence/member/static/zip"),l=e("./sequence/member/static/difference"),d=e("./sequence/member/static/union"),h=e("./sequence/member/static/intersect"),f=e("./sequence/member/static/pure"),p=e("./sequence/member/static/return"),m=e("./sequence/member/static/sequence"),v=e("./sequence/member/static/mempty"),y=e("./sequence/member/static/mconcat"),b=e("./sequence/member/static/mappend"),w=e("./sequence/member/static/mzero"),g=e("./sequence/member/static/mplus"),q=e("./sequence/member/instance/extract"),S=e("./sequence/member/instance/iterate"),_=e("./sequence/member/instance/memoize"),x=e("./sequence/member/instance/reduce"),P=e("./sequence/member/instance/take"),E=e("./sequence/member/instance/drop"),T=e("./sequence/member/instance/takeWhile"),k=e("./sequence/member/instance/dropWhile"),j=e("./sequence/member/instance/takeUntil"),M=e("./sequence/member/instance/dropUntil"),O=e("./sequence/member/instance/sort"),R=e("./sequence/member/instance/unique"),A=e("./sequence/member/instance/fmap"),L=e("./sequence/member/instance/ap"),C=e("./sequence/member/instance/bind"),I=e("./sequence/member/instance/join"),z=e("./sequence/member/instance/mapM"),F=e("./sequence/member/instance/filterM"),N=e("./sequence/member/instance/map"),U=e("./sequence/member/instance/filter"),D=e("./sequence/member/instance/scanl"),$=e("./sequence/member/instance/foldr"),H=e("./sequence/member/instance/group"),G=e("./sequence/member/instance/inits"),W=e("./sequence/member/instance/tails"),V=e("./sequence/member/instance/segs"),J=e("./sequence/member/instance/subsequences"),B=e("./sequence/member/instance/permutations");e("../compose").compose(r.Sequence,i.default,s.default,o.default,c.default,u.default,a.default,l.default,d.default,h.default,f.default,p.default,m.default,v.default,y.default,b.default,w.default,g.default,q.default,S.default,_.default,x.default,P.default,E.default,T.default,k.default,j.default,M.default,O.default,R.default,A.default,L.default,C.default,I.default,z.default,F.default,N.default,U.default,D.default,$.default,H.default,G.default,W.default,V.default,J.default,B.default)},{"../compose":9,"./sequence/core":32,"./sequence/member/instance/ap":33,"./sequence/member/instance/bind":34,"./sequence/member/instance/drop":35,"./sequence/member/instance/dropUntil":36,"./sequence/member/instance/dropWhile":37,"./sequence/member/instance/extract":38,"./sequence/member/instance/filter":39,"./sequence/member/instance/filterM":40,"./sequence/member/instance/fmap":41,"./sequence/member/instance/foldr":42,"./sequence/member/instance/group":43,"./sequence/member/instance/inits":44,"./sequence/member/instance/iterate":45,"./sequence/member/instance/join":46,"./sequence/member/instance/map":47,"./sequence/member/instance/mapM":48,"./sequence/member/instance/memoize":49,"./sequence/member/instance/permutations":50,"./sequence/member/instance/reduce":51,"./sequence/member/instance/scanl":52,"./sequence/member/instance/segs":53,"./sequence/member/instance/sort":54,"./sequence/member/instance/subsequences":55,"./sequence/member/instance/tails":56,"./sequence/member/instance/take":57,"./sequence/member/instance/takeUntil":58,"./sequence/member/instance/takeWhile":59,"./sequence/member/instance/unique":60,"./sequence/member/static/concat":61,"./sequence/member/static/cycle":62,"./sequence/member/static/difference":63,"./sequence/member/static/from":64,"./sequence/member/static/intersect":65,"./sequence/member/static/mappend":66,"./sequence/member/static/mconcat":67,"./sequence/member/static/mempty":68,"./sequence/member/static/mplus":69,"./sequence/member/static/mzero":70,"./sequence/member/static/pure":71,"./sequence/member/static/random":72,"./sequence/member/static/resume":73,"./sequence/member/static/return":74,"./sequence/member/static/sequence":75,"./sequence/member/static/union":76,"./sequence/member/static/zip":77}],32:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../monadplus");class i extends r.MonadPlus{constructor(e){super(s),this.cons=e}[Symbol.iterator](){let e=()=>this.iterate();return{next(){const t=e();return e=i.Thunk.iterator(t),{done:!i.isIterable(t),value:i.Thunk.value(t)}}}}}function s(){throw new Error("Spica: Sequence: Invalid thunk call.")}n.Sequence=i,i=n.Sequence||(n.Sequence={}),function(e){let t,n,r,i;!function(t){t.cons=function(t,n){switch(arguments.length){case 0:return[];case 1:return[t];case 2:return[t,n];default:throw e.Exception.invalidConsError(arguments)}}}(t=e.Data||(e.Data={})),function(e){e.value=function(e){return e[0]},e.iterator=function(e){return e[1]},e.index=function(e){return e[2]}}(n=e.Thunk||(e.Thunk={})),function(t){t.done=(()=>[void 0,t.done,-1]),t.when=function t(r,i,s){return e.isIterable(r)?s(r,()=>t(n.iterator(r)(),i,s)):i(r)}}(r=e.Iterator||(e.Iterator={})),e.isIterable=function(e){return n.iterator(e)!==r.done},function(e){e.invalidConsError=function(e){return console.error(e,e.length,e[0],e[1]),new TypeError("Spica: Sequence: Invalid parameters of cons.")},e.invalidDataError=function(e){return console.error(e),new TypeError("Spica: Sequence: Invalid data.")},e.invalidThunkError=function(e){return console.error(e),new TypeError("Spica: Sequence: Invalid thunk.")}}(i=e.Exception||(e.Exception={}))}(i=n.Sequence||(n.Sequence={}))},{"../monadplus":30}],33:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{ap(e){return r.Sequence.ap(this,e)}}},{"../../core":32}],34:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{bind(e){return r.Sequence.concat(this.fmap(e))}}},{"../../core":32}],35:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{drop(e){return new r.Sequence((t=(()=>this.iterate()),n)=>r.Sequence.Iterator.when(t(),()=>n(),(t,i)=>r.Sequence.Thunk.index(t)<e?i():n(r.Sequence.Thunk.value(t),r.Sequence.Thunk.iterator(t))))}}},{"../../core":32}],36:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{dropUntil(e){return new r.Sequence((t=(()=>this.iterate()),n)=>r.Sequence.Iterator.when(t(),()=>n(),(t,i)=>e(r.Sequence.Thunk.value(t))?i():n(r.Sequence.Thunk.value(t),r.Sequence.Thunk.iterator(t))))}}},{"../../core":32}],37:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{dropWhile(e){return new r.Sequence((t=(()=>this.iterate()),n)=>r.Sequence.Iterator.when(t(),()=>n(),(t,i)=>e(r.Sequence.Thunk.value(t))?i():n(r.Sequence.Thunk.value(t),r.Sequence.Thunk.iterator(t))))}}},{"../../core":32}],38:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core"),i=e("../../../../concat");n.default=class extends r.Sequence{extract(){const e=[];let t=()=>this.iterate();for(;;){const n=t();if(!r.Sequence.isIterable(n))return e;i.concat(e,[r.Sequence.Thunk.value(n)]),t=r.Sequence.Thunk.iterator(n)}}}},{"../../../../concat":10,"../../core":32}],39:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{filter(e){return new r.Sequence((t=(()=>this.iterate()),n)=>r.Sequence.Iterator.when(t(),()=>n(),(t,i)=>e(r.Sequence.Thunk.value(t),r.Sequence.Thunk.index(t))?n(r.Sequence.Thunk.value(t),r.Sequence.Thunk.iterator(t)):i()))}}},{"../../core":32}],40:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core"),i=e("../../../../concat");n.default=class extends r.Sequence{filterM(e){return r.Sequence.from([0]).bind(()=>{const t=this.extract();switch(t.length){case 0:return r.Sequence.from([[]]);default:{const n=t.shift();return e(n).bind(s=>s?0===t.length?r.Sequence.from([[n]]):r.Sequence.from(t).filterM(e).fmap(e=>i.concat([n],e)):0===t.length?r.Sequence.from([[]]):r.Sequence.from(t).filterM(e))}}})}}},{"../../../../concat":10,"../../core":32}],41:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{fmap(e){return new r.Sequence((t=(()=>this.iterate()))=>r.Sequence.Iterator.when(t(),()=>r.Sequence.Data.cons(),t=>r.Sequence.Data.cons(e(r.Sequence.Thunk.value(t)),r.Sequence.Thunk.iterator(t))))}}},{"../../core":32}],42:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{foldr(e,t){return new r.Sequence((n=(()=>this.reduce().iterate()))=>r.Sequence.Iterator.when(n(),()=>r.Sequence.Data.cons(t),n=>r.Sequence.Data.cons(e(r.Sequence.Thunk.value(n),r.Sequence.resume(r.Sequence.Thunk.iterator(n)).foldr(e,t))))).bind(e=>e)}}},{"../../core":32}],43:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core"),i=e("../../../../concat");n.default=class extends r.Sequence{group(e){return new r.Sequence(([t,n]=[()=>this.iterate(),[]],s)=>r.Sequence.Iterator.when(t(),()=>0===n.length?s():s(n),(t,o)=>0===n.length||e(n[0],r.Sequence.Thunk.value(t))?(i.concat(n,[r.Sequence.Thunk.value(t)]),o()):s(n,[r.Sequence.Thunk.iterator(t),i.concat([],[r.Sequence.Thunk.value(t)])])))}}},{"../../../../concat":10,"../../core":32}],44:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{inits(){return r.Sequence.mappend(r.Sequence.from([[]]),this.scanl((e,t)=>[...e,t],[]).dropWhile(e=>0===e.length))}}},{"../../core":32}],45:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{iterate(){return this.iterate_()}iterate_(e,t=0){const n=this.cons(e,r.Sequence.Data.cons);switch(n.length){case 0:return[void 0,r.Sequence.Iterator.done,-1];case 1:return[n[0],()=>r.Sequence.Iterator.done(),t];case 2:return[n[0],()=>this.iterate_(n[1],t+1),t];default:throw r.Sequence.Exception.invalidDataError(n)}}}},{"../../core":32}],46:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{join(){return r.Sequence.concat(this)}}},{"../../core":32}],47:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{map(e){return new r.Sequence((t=(()=>this.iterate()))=>r.Sequence.Iterator.when(t(),()=>r.Sequence.Data.cons(),t=>r.Sequence.Data.cons(e(r.Sequence.Thunk.value(t),r.Sequence.Thunk.index(t)),r.Sequence.Thunk.iterator(t))))}}},{"../../core":32}],48:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core"),i=e("../../../../concat");n.default=class extends r.Sequence{mapM(e){return r.Sequence.from([0]).bind(()=>{const t=this.extract();switch(t.length){case 0:return r.Sequence.mempty;default:{const n=t.shift();return e(n).bind(n=>0===t.length?r.Sequence.from([[n]]):r.Sequence.from(t).mapM(e).fmap(e=>i.concat([n],e)))}}})}}},{"../../../../concat":10,"../../core":32}],49:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core"),i=new WeakMap;n.default=class extends r.Sequence{memoize(){return new r.Sequence(([e,t]=[0,i.get(this)||i.set(this,new Map).get(this)],n)=>r.Sequence.Iterator.when(t.get(e)||t.set(e,e>0&&t.has(e-1)?r.Sequence.Thunk.iterator(t.get(e-1))():this.iterate()).get(e),()=>n(),i=>n(r.Sequence.Thunk.value(i),[e+1,t])))}}},{"../../core":32}],50:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{permutations(){return r.Sequence.from([0]).bind(()=>{const e=this.extract();return 0===e.length?r.Sequence.mempty:r.Sequence.from([e])}).bind(e=>r.Sequence.mappend(r.Sequence.from([e]),function e(t,n){return r.Sequence.Iterator.when(t.iterate(),()=>r.Sequence.mempty,t=>new r.Sequence((i,s)=>r.Sequence.Iterator.when(t,()=>s(),t=>{const i=r.Sequence.Thunk.value(t),o=r.Sequence.resume(r.Sequence.Thunk.iterator(t)).memoize();return s(n.permutations().foldr((e,t)=>(function(e,t){return function e(t,n,s){return r.Sequence.Iterator.when(n.iterate(),()=>[o,s],n=>{const o=r.Sequence.Thunk.value(n),[c,u]=e(e=>t(r.Sequence.mappend(r.Sequence.from([o]),e)),r.Sequence.resume(r.Sequence.Thunk.iterator(n)),s);return[r.Sequence.mappend(r.Sequence.from([o]),c),r.Sequence.mappend(r.Sequence.from([t(r.Sequence.mappend(r.Sequence.from([i]),r.Sequence.mappend(r.Sequence.from([o]),c))).extract()]),u)]})}(e=>e,e,t)[1]})(r.Sequence.from(e),t),e(o,r.Sequence.mappend(r.Sequence.from([i]),n))))})).bind(e=>e))}(r.Sequence.from(e),r.Sequence.mempty)))}}},{"../../core":32}],51:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{reduce(){return new r.Sequence(([e,t]=[0,new Map],n)=>r.Sequence.Iterator.when(t.get(e)||t.set(e,e>0&&t.has(e-1)?r.Sequence.Thunk.iterator(t.get(e-1))():this.iterate()).get(e),()=>n(),i=>n(r.Sequence.Thunk.value(i),[e+1,t])))}}},{"../../core":32}],52:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{scanl(e,t){return new r.Sequence(([n,i,s]=[t,()=>this.iterate(),0])=>r.Sequence.Iterator.when(i(),()=>0===s?r.Sequence.Data.cons(t):r.Sequence.Data.cons(),t=>r.Sequence.Data.cons(n=e(n,r.Sequence.Thunk.value(t)),[n,r.Sequence.Thunk.iterator(t),r.Sequence.Thunk.index(t)+1])))}}},{"../../core":32}],53:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core"),i=e("../../../../concat");n.default=class extends r.Sequence{segs(){return r.Sequence.mappend(this.foldr((e,t)=>t.take(1).bind(n=>r.Sequence.mappend(r.Sequence.from([r.Sequence.mappend(r.Sequence.from([[e]]),r.Sequence.from(n).map(t=>i.concat([e],t)))]),t)),r.Sequence.from([r.Sequence.from([])])).bind(e=>e),r.Sequence.from([[]]))}}},{"../../../../concat":10,"../../core":32}],54:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{sort(e){return r.Sequence.from(this.extract().sort(e))}}},{"../../core":32}],55:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core"),i=e("../../../../concat");n.default=class extends r.Sequence{subsequences(){return r.Sequence.mappend(r.Sequence.from([[]]),r.Sequence.from([0]).bind(()=>(function e(t){return r.Sequence.Iterator.when(t.iterate(),()=>r.Sequence.mempty,t=>r.Sequence.mappend(r.Sequence.from([[r.Sequence.Thunk.value(t)]]),new r.Sequence((n,s)=>r.Sequence.Iterator.when(t,()=>s(),t=>s(e(r.Sequence.resume(r.Sequence.Thunk.iterator(t))).foldr((e,n)=>r.Sequence.mappend(r.Sequence.mappend(r.Sequence.from([e]),r.Sequence.from([i.concat([r.Sequence.Thunk.value(t)],e)])),n),r.Sequence.mempty)))).bind(e=>e)))})(this)))}}},{"../../../../concat":10,"../../core":32}],56:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{tails(){return r.Sequence.mappend(r.Sequence.from(this.extract().map((e,t,n)=>n.slice(t))),r.Sequence.from([[]]))}}},{"../../core":32}],57:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{take(e){return new r.Sequence((t=(()=>this.iterate()),n)=>r.Sequence.Iterator.when(e>0?t():r.Sequence.Iterator.done(),()=>n(),t=>r.Sequence.Thunk.index(t)+1<e?n(r.Sequence.Thunk.value(t),r.Sequence.Thunk.iterator(t)):n(r.Sequence.Thunk.value(t))))}}},{"../../core":32}],58:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{takeUntil(e){return new r.Sequence((t=(()=>this.iterate()),n)=>r.Sequence.Iterator.when(t(),()=>n(),t=>e(r.Sequence.Thunk.value(t))?n(r.Sequence.Thunk.value(t)):n(r.Sequence.Thunk.value(t),r.Sequence.Thunk.iterator(t))))}}},{"../../core":32}],59:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{takeWhile(e){return new r.Sequence((t=(()=>this.iterate()),n)=>r.Sequence.Iterator.when(t(),()=>n(),t=>e(r.Sequence.Thunk.value(t))?n(r.Sequence.Thunk.value(t),r.Sequence.Thunk.iterator(t)):n()))}}},{"../../core":32}],60:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{unique(){const e=new Set;return this.filter(t=>!e.has(t)&&!!e.add(t))}}},{"../../core":32}],61:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{static concat(e){return new r.Sequence(([t,n]=[()=>e.iterate(),r.Sequence.Iterator.done],i)=>r.Sequence.Iterator.when(t(),()=>i(),(e,t)=>(n=n===r.Sequence.Iterator.done?()=>r.Sequence.Thunk.value(e).iterate():n,r.Sequence.Iterator.when(n(),()=>(n=r.Sequence.Iterator.done,t()),t=>i(r.Sequence.Thunk.value(t),[()=>e,r.Sequence.Thunk.iterator(t)])))))}}},{"../../core":32}],62:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{static cycle(e){return new r.Sequence(function t([n,r]=[e[Symbol.iterator](),0],i){const s=n.next();return s.done?t([e[Symbol.iterator](),r+1],i):i(s.value,[n,r+1])}).reduce()}}},{"../../core":32}],63:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{static difference(e,t,n){return new r.Sequence(([i,s]=[()=>e.iterate(),()=>t.iterate()],o)=>r.Sequence.Iterator.when(i(),()=>r.Sequence.Iterator.when(s(),()=>o(),e=>o(r.Sequence.Thunk.value(e),[r.Sequence.Iterator.done,r.Sequence.Thunk.iterator(e)])),(e,t)=>r.Sequence.Iterator.when(s(),()=>o(r.Sequence.Thunk.value(e),[r.Sequence.Thunk.iterator(e),r.Sequence.Iterator.done]),i=>{const c=n(r.Sequence.Thunk.value(e),r.Sequence.Thunk.value(i));return c<0?o(r.Sequence.Thunk.value(e),[r.Sequence.Thunk.iterator(e),()=>i]):c>0?o(r.Sequence.Thunk.value(i),[()=>e,r.Sequence.Thunk.iterator(i)]):(s=(()=>r.Sequence.Thunk.iterator(i)()),t())})))}}},{"../../core":32}],64:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{static from(e){return new r.Sequence(([t,n]=[e[Symbol.iterator](),0],r)=>{const i=t.next();return i.done?r():r(i.value,[t,n+1])}).reduce()}}},{"../../core":32}],65:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{static intersect(e,t,n){return new r.Sequence(([i,s]=[()=>e.iterate(),()=>t.iterate()],o)=>r.Sequence.Iterator.when(i(),()=>o(),(e,t)=>r.Sequence.Iterator.when(s(),()=>o(),(i,c)=>{const u=n(r.Sequence.Thunk.value(e),r.Sequence.Thunk.value(i));return u<0?(s=(()=>i),t()):u>0?c():o(r.Sequence.Thunk.value(e),[r.Sequence.Thunk.iterator(e),r.Sequence.Thunk.iterator(i)])})))}}},{"../../core":32}],66:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{static mappend(e,t){return r.Sequence.mconcat([e,t])}}},{"../../core":32}],67:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{static mconcat(e){return[...e].reduce((e,t)=>(function(e,t){return new r.Sequence(([n,i]=[()=>e.iterate(),()=>t.iterate()],s)=>r.Sequence.Iterator.when(n(),()=>r.Sequence.Iterator.when(i(),()=>s(),e=>s(r.Sequence.Thunk.value(e),[r.Sequence.Iterator.done,r.Sequence.Thunk.iterator(e)])),e=>s(r.Sequence.Thunk.value(e),[r.Sequence.Thunk.iterator(e),i])))})(e,t),r.Sequence.mempty)}}},{"../../core":32}],68:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");class i extends r.Sequence{}n.default=i,i.mempty=new r.Sequence((e,t)=>t())},{"../../core":32}],69:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");class i extends r.Sequence{}n.default=i,i.mplus=r.Sequence.mappend},{"../../core":32}],70:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");class i extends r.Sequence{}n.default=i,i.mzero=r.Sequence.mempty},{"../../core":32}],71:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{static pure(e){return new r.Sequence((t,n)=>n(e))}}},{"../../core":32}],72:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{static random(e=(()=>Math.random())){return"function"==typeof e?r.Sequence.from(new r.Sequence((t,n)=>n(e(),t))):this.random().map(t=>e[t*e.length|0])}}},{"../../core":32}],73:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{static resume(e){return new r.Sequence((t=e,n)=>r.Sequence.Iterator.when(t(),()=>n(),e=>n(r.Sequence.Thunk.value(e),r.Sequence.Thunk.iterator(e))))}}},{"../../core":32}],74:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{static Return(e){return new r.Sequence((t,n)=>n(e))}}},{"../../core":32}],75:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{static sequence(e){return e.reduce((e,t)=>e.fmap(e=>r.Sequence.mappend(e,t)),r.Sequence.Return(r.Sequence.from([])))}}},{"../../core":32}],76:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{static union(e,t,n){return new r.Sequence(([i,s]=[()=>e.iterate(),()=>t.iterate()],o)=>r.Sequence.Iterator.when(i(),()=>r.Sequence.Iterator.when(s(),()=>o(),e=>o(r.Sequence.Thunk.value(e),[r.Sequence.Iterator.done,r.Sequence.Thunk.iterator(e)])),e=>r.Sequence.Iterator.when(s(),()=>o(r.Sequence.Thunk.value(e),[r.Sequence.Thunk.iterator(e),r.Sequence.Iterator.done]),t=>{const i=n(r.Sequence.Thunk.value(e),r.Sequence.Thunk.value(t));return i<0?o(r.Sequence.Thunk.value(e),[r.Sequence.Thunk.iterator(e),()=>t]):i>0?o(r.Sequence.Thunk.value(t),[()=>e,r.Sequence.Thunk.iterator(t)]):o(r.Sequence.Thunk.value(e),[r.Sequence.Thunk.iterator(e),r.Sequence.Thunk.iterator(t)])})))}}},{"../../core":32}],77:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{static zip(e,t){return new r.Sequence(([n,i]=[()=>e.iterate(),()=>t.iterate()],s)=>r.Sequence.Iterator.when(n(),()=>s(),e=>r.Sequence.Iterator.when(i(),()=>s(),t=>s([r.Sequence.Thunk.value(e),r.Sequence.Thunk.value(t)],[r.Sequence.Thunk.iterator(e),r.Sequence.Thunk.iterator(t)]))))}}},{"../../core":32}],78:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.noop=function(){}},{}],79:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./global"),i=e("./assign"),s=e("./concat"),o=e("./equal"),c=e("./exception"),{Map:u,WeakSet:a,Error:l}=r.global;var d;!function(e){e.Monitor="monitor",e.Subscriber="subscriber"}(d||(d={}));function h(e,t,n,r){return e.some(e=>e.type===t&&e.namespace.length===n.length&&e.namespace.every((e,t)=>e===n[t])&&e.listener===r)}n.Observation=class{constructor(e={}){this.settings={limit:10},this.relaySources=new a,this.node_={parent:void 0,children:new u,childrenNames:[],items:[]},i.extend(this.settings,e)}monitor(e,t,{once:n=!1}={}){if("function"!=typeof t)throw new l(`Spica: Observation: Invalid listener: ${t}`);const r=()=>this.off(e,t,"monitor"),{items:i}=this.seekNode_(e);if(h(i,"monitor",e,t))return r;if(i.length===this.settings.limit)throw new l("Spica: Observation: Exceeded max listener limit.");return i.push({type:"monitor",namespace:e,listener:t,options:{once:n}}),r}on(e,t,{once:n=!1}={}){if("function"!=typeof t)throw new l(`Spica: Observation: Invalid listener: ${t}`);const r=()=>this.off(e,t),{items:i}=this.seekNode_(e);if(h(i,"subscriber",e,t))return r;if(i.length===this.settings.limit)throw new l("Spica: Observation: Exceeded max listener limit.");return i.push({type:"subscriber",namespace:e,listener:t,options:{once:n}}),r}once(e,t){return this.on(e,t,{once:!0})}off(e,t,n="subscriber"){switch(typeof t){case"function":return void this.seekNode_(e).items.some(({type:e,listener:r},i,s)=>{if(r!==t)return!1;if(e!==n)return!1;switch(i){case 0:return s.shift(),!0;case s.length-1:return s.pop(),!0;default:return s.splice(i,1),!0}});case"undefined":{const t=this.seekNode_(e);for(let n=0;n<t.childrenNames.length;++n){const r=t.childrenNames[n];this.off([...e,r]);const i=t.children.get(r);i.items.length+i.childrenNames.length>0||(t.children.delete(r),t.childrenNames.splice(o.findIndex(r,t.childrenNames),1),--n)}return void s.concat(t.items,t.items.splice(0,1/0).filter(({type:e})=>"monitor"===e))}default:throw new l("Spica: Observation: Unreachable.")}}emit(e,t,n){this.drain_(e,t,n)}reflect(e,t){let n=[];return this.emit(e,t,(e,t)=>n=t),n}relay(e){if(this.relaySources.has(e))return()=>void 0;this.relaySources.add(e);const t=e.monitor([],(e,t)=>void this.emit(t,e));return()=>(this.relaySources.delete(e),t())}drain_(e,t,n){const r=[];for(const{type:i,listener:s,options:{once:o}}of this.refsBelow_(this.seekNode_(e)))if("subscriber"===i){o&&this.off(e,s);try{const i=s(t,e);n&&(r[r.length]=i)}catch(e){c.causeAsyncException(e)}}for(const{type:n,listener:r,options:{once:i}}of this.refsAbove_(this.seekNode_(e)))if("monitor"===n){i&&this.off(e,r,"monitor");try{r(t,e)}catch(e){c.causeAsyncException(e)}}if(n)try{n(t,r)}catch(e){c.causeAsyncException(e)}}refs(e){return this.refsBelow_(this.seekNode_(e))}refsAbove_({parent:e,items:t}){for(t=t.slice();e;)s.concat(t,e.items),e=e.parent;return t}refsBelow_({childrenNames:e,children:t,items:n}){n=n.slice();for(let r=0;r<e.length;++r){const i=e[r],c=this.refsBelow_(t.get(i));s.concat(n,c),0===c.length&&(t.delete(i),e.splice(o.findIndex(i,e),1),--r)}return n}seekNode_(e){return e.reduce((e,t)=>{const{children:n}=e;return n.has(t)||(e.childrenNames.push(t),n.set(t,{parent:e,children:new u,childrenNames:[],items:[]})),n.get(t)},this.node_)}}},{"./assign":4,"./concat":10,"./equal":14,"./exception":15,"./global":18}],80:[function(e,t,n){"use strict";var r;Object.defineProperty(n,"__esModule",{value:!0});const i=e("./concat");var s;!function(e){e[e.pending=0]="pending",e[e.resolved=1]="resolved",e[e.rejected=2]="rejected"}(s||(s={}));class o{constructor(){this.status={state:0},this.fulfillReactions=[],this.rejectReactions=[],this.isHandled=!1}}const c=Symbol.for("spica/promise::internal");class u{constructor(e){this[Symbol.toStringTag]="Promise",this[r]=new o;try{e(e=>{0===this[c].status.state&&(this[c].status={state:1,result:d(e)?{value:e,promise:!0}:{value:e,promise:!1}}),a(this[c])},e=>{0===this[c].status.state&&(this[c].status={state:2,result:{value:e}}),a(this[c])})}catch(e){0===this[c].status.state&&(this[c].status={state:2,result:{value:e}}),a(this[c])}}static get[Symbol.species](){return u}static all(e){return e.reduce((e,t)=>e.then(e=>u.resolve(t).then(t=>i.concat(e,[t]))),u.resolve([]))}static race(e){return new u((t,n)=>{for(const r of e)u.resolve(r).then(t,n)})}static resolve(e){return new u(t=>void t(e))}static reject(e){return new u((t,n)=>void n(e))}then(e,t){return new u((n,r)=>{const{fulfillReactions:i,rejectReactions:s}=this[c];i.push(t=>{if(e)try{n(e(t))}catch(e){r(e)}else n(t)}),s.push(e=>{if(t)try{n(t(e))}catch(e){r(e)}else r(e)}),a(this[c])})}catch(e){return this.then(void 0,e)}finally(e){return this.then(e,e).then(()=>this)}}function a(e){const{status:t,fulfillReactions:n,rejectReactions:r}=e;switch(e.isHandled=!0,t.state){case 0:return;case 1:return t.result.promise?void t.result.value.then(e=>void l(n,e),e=>void l(r,e)):void l(n,t.result.value);case 2:return void l(r,t.result.value)}}function l(e,t){for(;e.length>0;)e.shift()(t)}function d(e){return!!e&&"object"==typeof e&&"then"in e&&"function"==typeof e.then}n.AtomicPromise=u,r=c,n.isPromiseLike=d},{"./concat":10}],81:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}(e("./monad/sequence"))},{"./monad/sequence":31}],82:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r="0".repeat(15);let i=0;n.sqid=function(e){if(arguments.length>0){if("number"!=typeof e)throw new TypeError(`Spica: sqid: A parameter value must be a number: ${e}`);if(e>=0==0)throw new TypeError(`Spica: sqid: A parameter value must be a positive number: ${e}`);if(e%1!=0)throw new TypeError(`Spica: sqid: A parameter value must be an integer: ${e}`)}return void 0===e?(r+ ++i).slice(-15):(r+e).slice(-15)}},{}],83:[function(e,t,n){"use strict";var r,i=this&&this.__await||function(e){return this instanceof i?(this.v=e,this):new i(e)},s=this&&this.__asyncGenerator||function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,s=n.apply(e,t||[]),o=[];return r={},c("next"),c("throw"),c("return"),r[Symbol.asyncIterator]=function(){return this},r;function c(e){s[e]&&(r[e]=function(t){return new Promise(function(n,r){o.push([e,t,n,r])>1||u(e,t)})})}function u(e,t){try{(n=s[e](t)).value instanceof i?Promise.resolve(n.value.v).then(a,l):d(o[0][2],n)}catch(e){d(o[0][3],e)}var n}function a(e){u("next",e)}function l(e){u("throw",e)}function d(e,t){e(t),o.shift(),o.length&&u(o[0][0],o[0][1])}};Object.defineProperty(n,"__esModule",{value:!0});const o=e("./global"),c=e("./coroutine"),u=e("./promise"),a=e("./future"),l=e("./observation"),d=e("./assign"),h=e("./clock"),f=e("./sqid"),p=e("./noop"),m=e("./exception"),{Object:v,Set:y,Map:b,WeakSet:w,Error:g,setTimeout:q}=o.global;class S extends c.Coroutine{constructor(e={}){if(super(function(){return s(this,arguments,function*(){return yield i(this.state)})}),this.state=new a.AtomicFuture,this.id=f.sqid(),this.settings={name:"",size:1/0,timeout:1/0,destructor:e=>void 0,scheduler:h.tick,resource:10},this.events_={init:new l.Observation,loss:new l.Observation,exit:new l.Observation},this.events=this.events_,this.workers=new b,this.alive=!0,this.available=!0,this[r]={recv:()=>{throw new g(`Spica: Supervisor: <${this.id}/${this.name}>: Cannot use coroutine port.`)},send:()=>{throw new g(`Spica: Supervisor: <${this.id}/${this.name}>: Cannot use coroutine port.`)},connect:()=>{throw new g(`Spica: Supervisor: <${this.id}/${this.name}>: Cannot use coroutine port.`)}},this.scheduled=!1,this.scheduler=(()=>void(0,this.settings.scheduler)(this.deliver)),this.messages=[],this.deliver=(()=>{if(!this.available)return;this.scheduled=!1;const e=Date.now();for(let t=0,n=this.messages.length;this.available&&t<n;++t){if(this.settings.resource-(Date.now()-e)<=0)return void this.schedule();const[r,i,s,o]=this.messages[t],c="string"==typeof r?[r]:r;let u;for(const e of c)if(u=this.workers.has(e)?this.workers.get(e).call([i,o]):void 0)break;if(!(void 0===u&&Date.now()<o))if(0===t?this.messages.shift():this.messages.splice(t,1),--t,--n,void 0===u){const e=c[Symbol.iterator]().next().value;this.events_.loss.emit([e],[e,i]);try{s(void 0,new g("Spica: Supervisor: A process has failed."))}catch(e){m.causeAsyncException(e)}}else u.then(e=>void s(e),()=>void s(void 0,new g("Spica: Supervisor: A process has failed.")))}}),this[c.Coroutine.init](),d.extend(this.settings,e),this.name=this.settings.name,this.constructor===S)throw new g(`Spica: Supervisor: <${this.id}/${this.name}>: Cannot instantiate abstract classes.`);this.constructor.instances.add(this)}static get instances(){return this.hasOwnProperty("instances_")?this.instances_:this.instances_=new y}static get count(){return this.instances.size}static get procs(){return[...this.instances].reduce((e,t)=>e+t.workers.size,0)}static clear(e){for(;this.instances.size>0;)for(const t of this.instances)t.terminate(e)}destructor(e){for(this.available=!1,this.clear(e),v.freeze(this.workers);this.messages.length>0;){const[e,t]=this.messages.shift(),n="string"==typeof e?[e]:[...e];this.events_.loss.emit([n[0]],[n[0],t])}this.alive=!1,this.constructor.instances.delete(this),v.freeze(this),this.settings.destructor(e),this.state.bind(void 0===e?void 0:u.AtomicPromise.reject(e))}throwErrorIfNotAvailable(){if(!this.available)throw new g(`Spica: Supervisor: <${this.id}/${this.name}>: A supervisor is already terminated.`)}register(e,t,n){if(n=n,this.throwErrorIfNotAvailable(),c.isCoroutine(t)){const r={init:e=>e,main:(e,n,r)=>t[c.Coroutine.port].send(e).then(({value:e,done:t})=>t&&void r()||[e,n]),exit:e=>void t[c.Coroutine.terminate](e)};this.constructor.standalone.add(r);const i=this.register(e,r,n);return t.catch(i),i}if(function(e){return"AsyncGeneratorFunction"===e[Symbol.toStringTag]}(t)){let r;return this.register(e,{init:(e,n)=>(r=t(e,n),r.next().catch(n),e),main:(e,t,n)=>u.AtomicPromise.resolve(r.next(e)).then(({value:e,done:r})=>r&&void n()||[e,t]),exit:()=>void 0},n)}if("function"==typeof t){if(function(e){return"GeneratorFunction"===e[Symbol.toStringTag]}(t)){let r;return this.register(e,{init:(e,n)=>(r=t(e,n),r.next(),e),main:(e,t,n)=>{const{value:i,done:s}=r.next(e);return s&&n(),[i,t]},exit:()=>void 0},n)}return this.register(e,{init:e=>e,main:t,exit:()=>void 0},n)}if(this.workers.has(e))throw new g(`Spica: Supervisor: <${this.id}/${this.name}/${e}>: Cannot register a process multiply with the same name.`);this.schedule();const r=new x(this,e,t,n,this.constructor.standalone.has(t),this.events_,()=>this.workers.get(e)===r&&void this.workers.delete(e));return this.workers.set(e,r),r.terminate}call(e,t,n=this.settings.timeout,r=this.settings.timeout){return this.call_("string"==typeof e?e:new _(this.workers,e),t,n,r)}call_(e,t,n,r){if("number"==typeof n)return new u.AtomicPromise((r,i)=>void this.call_(e,t,(e,t)=>t?i(t):r(e),n));for(this.messages.push([e,t,n,Date.now()+r]);this.messages.length>(this.available?this.settings.size:0);){const[e,t,n]=this.messages.shift(),r="string"==typeof e?[e]:[e[Symbol.iterator]().next().value];this.events_.loss.emit([r[0]],[r[0],t]);try{n(void 0,new g(`Spica: Supervisor: <${this.id}/${this.name}>: A message overflowed.`))}catch(e){m.causeAsyncException(e)}}this.throwErrorIfNotAvailable(),this.schedule(),r<=0||r!==1/0&&q(()=>void this.schedule(),r+3)}cast(e,t,n=this.settings.timeout){const r=this.cast_("string"==typeof e?e:new _(this.workers,e),t,n);return void 0!==r&&(r.catch(p.noop),!0)}cast_(e,t,n){this.throwErrorIfNotAvailable();const r="string"==typeof e?[e]:e;let i;for(const e of r)if(i=this.workers.has(e)?this.workers.get(e).call([t,Date.now()+n]):void 0)break;if(void 0===i){const e=r[Symbol.iterator]().next().value;this.events_.loss.emit([e],[e,t])}return i}refs(e){return void 0===e?[...this.workers.values()].map(t):this.workers.has(e)?[t(this.workers.get(e))]:[];function t(e){return[e.name,e.process,e.state,e.terminate]}}kill(e,t){return!!this.available&&(!!this.workers.has(e)&&this.workers.get(e).terminate(t))}clear(e){for(;this.workers.size>0;)for(const t of this.workers.values())t.terminate(e)}terminate(e){return!!this.available&&(this.destructor(e),this[c.Coroutine.exit](void 0),!0)}[c.Coroutine.terminate](e){this.terminate(e)}schedule(){this.scheduled||0!==this.messages.length&&(h.tick(this.scheduler),this.scheduled=!0)}}n.Supervisor=S,r=c.Coroutine.port,S.standalone=new w;class _{constructor(e,t=(e=>e)){this.workers=e,this.selector=t}*[Symbol.iterator](){let e=0;for(const t of this.selector(this.workers.keys()))++e,yield t;0===e&&(yield"")}}class x{constructor(e,t,n,r,i,s,o){this.sv=e,this.name=t,this.process=n,this.state=r,this.events=s,this.destructor_=o,this.alive=!0,this.available=!0,this.initiated=!1,this.terminate=(e=>!!this.alive&&(this.destructor(e),!0)),i&&this.init()}destructor(e){this.alive=!1,this.available=!1,v.freeze(this);try{this.destructor_()}catch(e){m.causeAsyncException(e)}this.initiated&&this.exit(e)}init(){this.initiated=!0,this.events.init.emit([this.name],[this.name,this.process,this.state]),this.state=this.process.init(this.state,this.terminate)}exit(e){try{this.process.exit(e,this.state),this.events.exit.emit([this.name],[this.name,this.process,this.state,e])}catch(t){this.events.exit.emit([this.name],[this.name,this.process,this.state,e]),this.sv.terminate(t)}}call([e,t]){const n=Date.now();if(this.available&&!(n>t))return new u.AtomicPromise((r,i)=>{isFinite(t)&&q(()=>void i(new g),t-n),this.available=!1,this.initiated||(this.init(),this.alive)?u.AtomicPromise.resolve(this.process.main(e,this.state,this.terminate)).then(r,i):i()}).then(([e,t])=>(this.alive&&(this.sv.schedule(),this.state=t,this.available=!0),e)).catch(e=>{throw this.sv.schedule(),this.terminate(e),e})}}},{"./assign":4,"./clock":8,"./coroutine":11,"./exception":15,"./future":17,"./global":18,"./noop":78,"./observation":79,"./promise":80,"./sqid":82}],84:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./global"),{setTimeout:i}=r.global;n.throttle=function(e,t){let n=0,r=[];return s=>{r.push(s),n>0||(n=i(()=>{n=0,t(r[r.length-1],function(){const e=r;return r=[],e}())},e))}},n.debounce=function(e,t){let n=0,r=[];return s=>{r.push(s),n>0||(n=i(()=>{n=0,i(()=>{n>0||t(r[r.length-1],function(){const e=r;return r=[],e}())},r.length>1?e:0)},e))}}},{"./global":18}],85:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.tuple=function(e){return e}},{}],86:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=Object.prototype.toString;function i(e){const t=null==e?e:typeof e;switch(t){case void 0:case null:return`${e}`;case"boolean":case"number":case"bigint":case"string":case"symbol":return t;default:return r.call(e).slice(8,-1)}}n.type=i,n.isPrimitive=function(e){switch(i(e)){case"undefined":case"null":case"boolean":case"number":case"bigint":case"string":case"symbol":return!0;default:return!1}}},{}],87:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.uncurry=(e=>(...t)=>t.reduce((e,t)=>e(t),e))},{}],88:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./global"),i=e("./url/domain/format");var s=e("./url/domain/format");n.standardize=s.standardize;const{location:o}=r.global;n.URL=class{constructor(e,t=o.href){this.url=i.newURL(e,t)}get reference(){return this.url.href}get resource(){return`${this.origin}${this.pathname}${"?"===this.query?"":this.query}`}get origin(){return`${this.protocol}//${this.host}`}get scheme(){return this.url.protocol.slice(0,-1)}get protocol(){return this.url.protocol}get host(){return this.url.host}get hostname(){return this.url.hostname}get port(){return this.url.port}get path(){return`${this.pathname}${this.query}`}get pathname(){return this.url.pathname}get query(){return this.url.search||!this.url.href.split("#",1)[0].includes("?")?this.url.search:"?"}get fragment(){return this.url.hash||!this.url.href.includes("#")?this.url.hash:"#"}}},{"./global":18,"./url/domain/format":89}],89:[function(e,t,n){(function(t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../memoize"),i=e("../../cache"),s=e("../../flip"),o=e("../../uncurry"),{URL:c,location:u}=t;var a;function l(e){return e.trim().replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]?|[\uDC00-\uDFFF]/g,e=>2===e.length?e:"").replace(/%(?![0-9A-F]{2})|[^%\[\]]+/gi,encodeURI).replace(/\?[^#]+/,e=>"?"+e.slice(1).replace(/%[0-9A-F]{2}|[^=&]/gi,e=>e.length<3?encodeURIComponent(e):e)).replace(/%[0-9A-F]{2}/gi,e=>e.toUpperCase()).replace(/#.+/,e.slice(e.indexOf("#")).trim())}a||(a={}),n.standardize=function(e,t=u.href){return l(function(e,t){return n.newURL(e,t).href}(e,t))},n._encode=l,n.newURL=s.flip(o.uncurry(r.memoize(e=>r.memoize(t=>new c(function(e,t=u.href){return e.trim()||t}(t,e),e),new i.Cache(9)),new i.Cache(9))))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../cache":5,"../../flip":16,"../../memoize":21,"../../uncurry":87}],90:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",{random:i}=Math;n.uuid=function(){let e="";for(let t=0;t<r.length;++t){const n=r[t];if("x"===n||"y"===n){const t=16*i()|0;e+=("x"==n?t:3&t|8).toString(16)}else e+=n}return e}},{}],91:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),e("spica/global");var r=e("./src/dom/builder");n.Shadow=r.Shadow,n.HTML=r.HTML,n.SVG=r.SVG,n.API=r.API;var i=e("./src/dom/proxy");n.proxy=i.proxy;var s=e("./src/util/dom");n.frag=s.frag,n.shadow=s.shadow,n.html=s.html,n.svg=s.svg,n.text=s.text,n.element=s.element,n.define=s.define;var o=e("./src/util/listener");n.listen=o.listen,n.once=o.once,n.wait=o.wait,n.delegate=o.delegate,n.bind=o.bind,n.currentTarget=o.currentTarget;var c=e("./src/util/query");n.apply=c.apply},{"./src/dom/builder":92,"./src/dom/proxy":94,"./src/util/dom":95,"./src/util/listener":96,"./src/util/query":98,"spica/global":18}],92:[function(e,t,n){(function(t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./proxy"),i=e("../util/dom"),{Object:s}=t;function o(e,t=(e=>e)){return new Proxy(()=>void 0,function(e,t){return{apply(e,t,[n,...r]){return this.get(e,n,e)(...r)},get:(n,o)=>n[o]||o in n||"string"!=typeof o?n[o]:n[o]=function(e,n){return function c(u,a,l){if("function"==typeof u)return c(void 0,void 0,u);if("function"==typeof a)return c(u,void 0,a);if(void 0!==u&&function(e){return"object"!=typeof e||s.values(e).slice(-1).every(e=>"object"==typeof e)}(u))return c(void 0,u,l);const d=t(function(t,r,s){const c=t(n,e,r||{},s);if(e!==c.tagName.toLowerCase())throw new Error(`TypedDOM: Expected tag name is "${e}" but actually "${c.tagName.toLowerCase()}".`);if(t!==o){if(r)for(const e in r){if(!r.hasOwnProperty(e))continue;const t=r[e];"function"==typeof t&&c.removeEventListener(e,t)}i.define(c,r)}return c}(l||o,u,a));return 1===d.nodeType?new r.Elem(d,a):new r.Elem(d.host,a,d)};function o(e,t,n){return e(t,n)}}(o,e)}}(e,t))}n.API=o,n.Shadow=o(i.html,i.shadow),n.HTML=o(i.html),n.SVG=o(i.svg)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../util/dom":95,"./proxy":94}],93:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("spica/uuid"),i=e("spica/sqid"),s=r.uuid().slice(-7);n.uid=function(){return`id-${s}-${+i.sqid()}`}},{"spica/sqid":82,"spica/uuid":90}],94:[function(e,t,n){(function(t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./identity"),i=e("../util/dom"),{Array:s,Object:o,WeakMap:c,WeakSet:u,Event:a}=t;var l;!function(e){e.Void="void",e.Text="text",e.Array="array",e.Record="record"}(l||(l={}));const d=new c;function h(e){if(!d.has(e))throw new Error("TypedDOM: This element has no proxy.");return d.get(e)}n.proxy=h;Symbol.for("typed-dom/tag");function f({element:e}){if(e.parentElement&&d.has(e.parentElement))throw new Error("TypedDOM: Typed DOM children can't be used to another typed DOM.")}n.Elem=class{constructor(e,t,n=e){switch(this.element=e,this.children_=t,this.container=n,this.id_=this.element.id.trim(),!0){case void 0===t:this.type=l.Void;break;case"string"==typeof t:this.type=l.Text;break;case s.isArray(t):this.type=l.Array;break;case t&&"object"==typeof t:this.type=l.Record;break;default:throw new Error("TypedDOM: Invalid type children.")}switch(f(this),d.set(this.element,this),this.type){case l.Void:return void(this.initialChildren=new u);case l.Text:return this.initialChildren=new u,i.define(this.container,[]),this.children_=this.container.appendChild(i.text("")),void(this.children=t);case l.Array:return this.initialChildren=new u(t),i.define(this.container,[]),this.children_=[],void(this.children=t);case l.Record:return this.initialChildren=new u(o.values(t)),i.define(this.container,[]),this.children_=function(e,t){const n={};for(const r in t){if(!t.hasOwnProperty(r))continue;let i=t[r];f(i),e.appendChild(i.element),n[r]={configurable:!0,enumerable:!0,get:()=>i,set:t=>{const n=i;t!==n&&(t.element.parentElement!==e&&f(t),e.replaceChild(t.element,n.element),i=t)}}}return o.defineProperties(t,n)}(this.container,Object.assign({},t)),void(this.children=t);default:throw new Error("TypedDOM: Unreachable code.")}}get id(){return this.id_?this.id_:(this.id_=r.uid(),this.element.classList.add(this.id_),this.id_)}get query(){switch(!0){case this.element!==this.container:return":host";case this.id===this.element.id.trim():return`#${this.id}`;default:return`.${this.id}`}}scope(e){if("STYLE"!==e.element.nodeName)return;const t=/(^|[,}])(\s*)\$scope(?![\w-])(?=[^;{}]*{)/g,n=e.element,r=this.query;if(-1!==n.innerHTML.search(t)){switch(n.innerHTML=n.innerHTML.replace(t,(e,t,n)=>`${t}${n}${r}`),r[0]){case".":{const e=r.slice(1);if(!n.classList.contains(e))break;n.classList.add(e);break}}if(0!==n.children.length)for(const e of n.querySelectorAll("*"))e.remove()}}get children(){switch(this.type){case l.Text:return this.children_=this.children_.parentNode===this.container?this.children_:[...this.container.childNodes].find(e=>3===e.nodeType)||this.children_.cloneNode(),this.children_.textContent;default:return this.children_}}set children(e){const t=[],n=[];switch(this.type){case l.Void:return;case l.Text:{if(e===this.children&&!this.initialChildren.has(this.children_))return;const t=this.children_,n=t.textContent,r=e;if(t.textContent=r,r===n)return;return void this.element.dispatchEvent(new a("change",{bubbles:!1,cancelable:!0}))}case l.Array:{const r=e,i=[];this.children_=i;const s=new u;for(let e=0;e<r.length;++e){const t=r[e];if(s.has(t))throw new Error("TypedDOM: Typed DOM children can't repeatedly be used to the same object.");s.add(t),t.element.parentNode!==this.container&&f(t),t.element===this.container.children[e]?i.push(t):(t.element.parentNode!==this.container&&(this.scope(t),n.push(t)),this.container.insertBefore(t.element,this.container.children[e]),i.push(t))}o.freeze(i);for(let e=this.container.children.length;e>=r.length;--e)d.has(this.container.children[e])&&t.push(h(this.container.removeChild(this.container.children[e])));break}case l.Record:{const r=e,i=this.children_,s=new u;for(const e in i){if(!r.hasOwnProperty(e))continue;const o=i[e],c=r[e];if(s.has(c))throw new Error("TypedDOM: Typed DOM children can't repeatedly be used to the same object.");s.add(c),c.element.parentNode!==this.container&&f(c),(o.element!==c.element||this.initialChildren.has(o))&&(this.scope(c),n.push(c),t.push(o)),i[e]=r[e]}break}}for(const e of t)this.initialChildren.has(e)||e.element.dispatchEvent(new a("disconnect",{bubbles:!1,cancelable:!0}));for(const e of n)e.element.dispatchEvent(new a("connect",{bubbles:!1,cancelable:!0}));t.length+n.length>0&&this.element.dispatchEvent(new a("change",{bubbles:!1,cancelable:!0}))}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../util/dom":95,"./identity":93}],95:[function(e,t,n){(function(t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("spica/memoize"),{document:i}=t;var s;!function(e){e.HTML="HTML",e.SVG="SVG"}(s||(s={}));const o=new WeakMap;var c;function u(e,t,n){return l(i,"HTML",e,t,n)}function a(e){const t=c.text.cloneNode();return t.data=e,t}function l(e,t,n,r,i){const s=c.elem(e),o=`${t}:${n}`,u=n.includes("-")?d(e,t,n):s.has(o)?s.get(o).cloneNode(!0):s.set(o,d(e,t,n)).get(o).cloneNode(!0);return h(u,r,i),u}function d(e,t,n){if(1===e.nodeType)throw new Error("TypedDOM: Scoped custom elements are not supported.");switch(t){case"HTML":return e.createElement(n);case"SVG":return e.createElementNS("http://www.w3.org/2000/svg",n)}}function h(e,t,n){if(f(t))return h(e,void 0,t);if("string"==typeof n)return h(e,t,[a(n)]);if(t)for(const n in t){if(!t.hasOwnProperty(n))continue;const r=t[n];switch(typeof r){case"string":e.setAttribute(n,r);continue;case"function":if(n.length<3)throw new Error(`TypedDOM: Attribute names for event listeners must have an event name but got "${n}".`);if(!n.startsWith("on"))throw new Error(`TypedDOM: Attribute names for event listeners must start with "on" but got "${n}".`);e.addEventListener(n.slice(2),r,{passive:["wheel","mousewheel","touchstart","touchmove"].includes(n.slice(2))});continue;case"object":e.removeAttribute(n);continue;default:continue}}if(n){for(e.innerHTML="";e.firstChild;)e.removeChild(e.firstChild);e.append(...n)}return e}function f(e){return!!(null==e?void 0:e[Symbol.iterator])}!function(e){e.elem=r.memoize(()=>new Map,new WeakMap),e.text=i.createTextNode(""),e.frag=i.createDocumentFragment()}(c||(c={})),n.frag=function e(t){if("string"==typeof t)return e([a(t)]);const n=c.frag.cloneNode();return t&&n.append(...t),n},n.shadow=function e(t,n,r){return"string"==typeof t?e(u(t),n,r):n&&!f(n)?e(t,void 0,n):t.shadowRoot||o.has(t)?h(r?"open"===r.mode?t.shadowRoot||t.attachShadow(r):o.get(t)||o.set(t,t.attachShadow(r)).get(t):t.shadowRoot||o.get(t),n):h(r&&"open"!==r.mode?o.set(t,t.attachShadow(r)).get(t):t.attachShadow({mode:"open"}),void 0===n?t.childNodes:n)},n.html=u,n.svg=function(e,t,n){return l(i,"SVG",e,t,n)},n.text=a,n.element=l,n.define=h}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"spica/memoize":21}],96:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./noop"),i=e("spica/promise");function s(e,t,n,r=!1,i={}){return"string"==typeof n?o(e,t,n,r,Object.assign(Object.assign({},"boolean"==typeof i?{capture:i}:i),{once:!0})):c(e,t,n,Object.assign(Object.assign({},"boolean"==typeof r?{capture:r}:r),{once:!0}))}function o(e,t,n,r,i={}){return c(9===e.nodeType?e.documentElement:e,n,e=>{const o=(e.target.shadowRoot&&e.composedPath()[0]||e.target).closest(t);return o&&s(o,n,r,i),e.returnValue},Object.assign(Object.assign({},i),{capture:!0}))}function c(e,t,i,s=!1){e.addEventListener(t,c,s);let o=()=>(o=r.noop,void e.removeEventListener(t,c,s));return()=>void o();function c(e){return e[n.currentTarget]=e.currentTarget,i(e)}}n.currentTarget=Symbol(),n.listen=function(e,t,n,r=!1,i={}){return"string"==typeof n?o(e,t,n,r,i):c(e,t,n,r)},n.once=s,n.wait=function(e,t,n=!1,r={}){return new i.AtomicPromise(i=>"string"==typeof n?void s(e,t,n,i,r):void s(e,t,i,n))},n.delegate=o,n.bind=c},{"./noop":97,"spica/promise":80}],97:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.noop=function(){}},{}],98:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./dom");n.apply=function(e,t,n){const i=e.querySelectorAll(t);for(const e of i)r.define(e,n);return i}},{"./dom":95}],99:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./layer/interface/service/gui");n.default=r.GUI;var i=e("./layer/interface/service/gui");n.Pjax=i.GUI;var s=e("./lib/router");n.router=s.router},{"./layer/interface/service/gui":128,"./lib/router":138}],100:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../domain/router/api");var i=e("../domain/event/router");n.RouterEvent=i.RouterEvent,n.RouterEventType=i.RouterEventType,n.RouterEventSource=i.RouterEventSource;var s=e("../domain/data/config");n.Config=s.Config,n.scope=s.scope,n.route=function(e,t,n,i){return r.route(new r.RouterEntity(e,t,new r.RouterEntityState(n.process,n.scripts)),i)}},{"../domain/data/config":103,"../domain/event/router":105,"../domain/router/api":106}],101:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../domain/store/path");n.loadTitle=r.loadTitle,n.savePosition=r.savePosition},{"../domain/store/path":122}],102:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("spica/assign");function i(){window.history.replaceState(r.extend(window.history.state||{},{title:document.title}),document.title)}function s(){window.history.replaceState(r.extend(window.history.state||{},{position:{top:window.pageYOffset,left:window.pageXOffset}}),document.title)}i(),s(),n.loadTitle=function(){return window.history.state&&window.history.state.title||document.title},n.saveTitle=i,n.loadPosition=function(){return window.history.state&&window.history.state.position||{top:window.pageYOffset,left:window.pageXOffset}},n.savePosition=s},{"spica/assign":4}],103:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function c(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,c)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});const i=e("spica/assign");var s=e("./config/scope");n.scope=s.scope;n.Config=class{constructor(e){this.areas=["body"],this.link="a",this.form="form:not([method])",this.replace="",this.fetch={rewrite:e=>e,cache:(e,t)=>"",headers:new Headers,timeout:3e3,wait:0},this.update={rewrite:(e,t)=>void 0,head:"base, meta, link",css:!0,script:!0,ignore:"",ignores:{extension:'[href^="chrome-extension://"]',security:'[src*=".scr.kaspersky-labs.com/"]'},reload:"",logger:""},this.sequence=new o,this.progressbar="display:none;position:absolute;bottom:0;left:0;width:0;height:2px;background:rgb(40, 105, 255);",this.scope={},Object.defineProperties(this.update,{ignore:{enumerable:!1,set(e){this.ignores._=e},get(){return Object.keys(this.ignores).map(e=>this.ignores[e]).filter(e=>e.trim().length>0).join(",")}}}),i.extend(this,e),this.fetch.headers=new Headers(this.fetch.headers),Object.freeze(this),this.fetch.headers.set("X-Requested-With","XMLHttpRequest"),this.fetch.headers.set("X-Pjax","1")}filter(e){return e.matches(":not([target])")}fallback(e,t){if(e instanceof HTMLAnchorElement)window.location.assign(e.href);else if(e instanceof HTMLFormElement)window.location.assign(e.action);else{if(!(e instanceof Window))throw t;window.location.reload(!0)}}};class o{fetch(){return r(this,void 0,void 0,function*(){return"fetch"})}unload(){return r(this,void 0,void 0,function*(){return"unload"})}content(){return r(this,void 0,void 0,function*(){return"content"})}ready(){return r(this,void 0,void 0,function*(){return"ready"})}load(){return r(this,void 0,void 0,function*(){})}}},{"./config/scope":104,"spica/assign":4}],104:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../../../lib/router"),i=e("../../../domain/data/config"),s=e("spica/sequence"),o=e("spica/maybe"),c=e("spica/assign");n.scope=function(e,t){const n=Object.assign({"/":{}},e.scope);return s.Sequence.from(Object.keys(n).sort().reverse()).dropWhile(e=>!r.compare(e,t.orig)&&!r.compare(e,t.dest)).take(1).filter(e=>!!r.compare(e,t.orig)&&r.compare(e,t.dest)).map(e=>n[e]).map(t=>t?o.Just(new i.Config(c.extend({},e,t))):o.Nothing).extract().reduce((e,t)=>t,o.Nothing)}},{"../../../../lib/router":138,"../../../domain/data/config":103,"spica/assign":4,"spica/maybe":20,"spica/sequence":81}],105:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../../lib/dom"),i=e("spica/url"),s=e("typed-dom");var o,c;n.RouterEvent=class{constructor(e){this.original=e,this.type=this.original.type.toLowerCase(),this.source=this.original[s.currentTarget],this.request=new u(this.source),this.location=new a(this.request.url),Object.freeze(this)}},function(e){e.Anchor=HTMLAnchorElement,e.Form=HTMLFormElement,e.Window=window.Window}(o=n.RouterEventSource||(n.RouterEventSource={})),function(e){e.click="click",e.submit="submit",e.popstate="popstate"}(n.RouterEventType||(n.RouterEventType={})),function(e){e.GET="GET",e.POST="POST"}(c=n.RouterEventMethod||(n.RouterEventMethod={}));class u{constructor(e){this.source=e,this.method=(()=>{if(this.source instanceof o.Anchor)return c.GET;if(this.source instanceof o.Form)return this.source.method.toUpperCase()===c.POST?c.POST:c.GET;if(this.source instanceof o.Window)return c.GET;throw new TypeError})(),this.url=(()=>{if(this.source instanceof o.Anchor)return new i.URL(i.standardize(this.source.href));if(this.source instanceof o.Form)return this.source.method.toUpperCase()===c.GET?new i.URL(i.standardize(this.source.action.split(/[?#]/)[0]+`?${r.serialize(this.source)}`)):new i.URL(i.standardize(this.source.action.split(/[?#]/)[0]));if(this.source instanceof o.Window)return new i.URL(i.standardize(window.location.href));throw new TypeError})(),this.body=(()=>this.source instanceof o.Form&&this.method===c.POST?new FormData(this.source):null)(),Object.freeze(this)}}n.RouterEventRequest=u;class a{constructor(e){this.dest=e,this.orig=new i.URL(i.standardize(window.location.href)),Object.freeze(this)}}n.RouterEventLocation=a},{"../../../lib/dom":135,"spica/url":88,"typed-dom":91}],106:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function c(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,c)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});const i=e("./module/fetch"),s=e("./module/update"),o=e("./module/update/content"),c=e("../store/path"),u=e("spica/either");var a=e("./model/eav/entity");n.RouterEntity=a.RouterEntity,n.RouterEntityState=a.RouterEntityState,n.route=function(e,t){return r(this,void 0,void 0,function*(){return u.Right(void 0).bind(e.state.process.either).bind(()=>!function(e,t){return o.separate({src:e,dst:e},t).extract(()=>!1,()=>!0)}(t.document,e.config.areas)?u.Left(new Error("Failed to match areas.")):u.Right(void 0)).fmap(()=>i.fetch(e.event.request,e.config,e.state.process)).fmap(n=>r(this,void 0,void 0,function*(){return(yield n).fmap(([n,r])=>s.update(e,n,r,{document:t.document,position:c.loadPosition})).extract(u.Left)})).extract(u.Left)})}},{"../store/path":122,"./model/eav/entity":107,"./module/fetch":109,"./module/update":111,"./module/update/content":113,"spica/either":13}],107:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.RouterEntity=class{constructor(e,t,n){this.config=e,this.event=t,this.state=n,Object.freeze(this)}};n.RouterEntityState=class{constructor(e,t){this.process=e,this.scripts=t,Object.freeze(this)}}},{}],108:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../../../../../lib/html"),i=e("spica/url");n.FetchResponse=class{constructor(e,t){if(this.url=e,this.xhr=t,this.header=(e=>this.xhr.getResponseHeader(e)),this.document="document"===this.xhr.responseType?this.xhr.responseXML.cloneNode(!0):r.parse(this.xhr.responseText).extract(),e.origin!==new i.URL(t.responseURL).origin)throw new Error("Redirected to another origin.");Object.defineProperty(this.document,"URL",{configurable:!0,enumerable:!0,value:e.reference,writable:!1}),r.fix(this.document),Object.freeze(this)}}},{"../../../../../../lib/html":137,"spica/url":88}],109:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function c(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,c)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});const i=e("../module/fetch/xhr"),s=e("spica/clock");n.fetch=function({method:e,url:t,body:n},{fetch:{rewrite:o,cache:c,headers:u,timeout:a,wait:l},sequence:d},h){return r(this,void 0,void 0,function*(){window.dispatchEvent(new Event("pjax:fetch"));const[r,f]=yield Promise.all([d.fetch(void 0,{path:t.path,method:e,headers:u,body:n}),i.xhr(e,t,u,n,a,o,c,h),s.wait(l)]);return f.bind(h.either).fmap(e=>[e,r])})}},{"../module/fetch/xhr":110,"spica/clock":8}],110:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../model/eav/value/fetch"),i=e("spica/promise"),s=e("spica/sequence"),o=e("spica/either"),c=e("spica/cache"),u=e("spica/url"),a=new c.Cache(99),l=new c.Cache(99);function d(e,t){return s.Sequence.intersect(s.Sequence.from(n(e||"").sort()),s.Sequence.from(n(t).sort()),(e,t)=>e.localeCompare(t)).take(1).extract().length>0;function n(e){return e.split(/\s*;\s*/).filter(e=>e.length>0)}}n.xhr=function(e,t,n,s,c,h,f,p){(n=new Headers(n)).set("Accept",n.get("Accept")||"text/html");const m=new u.URL(u.standardize(h(t.path)));"GET"===e&&l.has(m.path)&&Date.now()>l.get(m.path).expiry&&n.set("If-None-Match",n.get("If-None-Match")||l.get(m.path).etag);const v="GET"===e&&f(m.path,n)||void 0;return new i.AtomicPromise(i=>{if(v&&a.has(v))return i(o.Right(a.get(v)(t,m)));const h=new XMLHttpRequest;h.open(e,m.path,!0);for(const[e,t]of n)h.setRequestHeader(e,t);h.responseType=window.navigator.userAgent.includes("Edge")?"text":"document",h.timeout=c,h.send(s),h.addEventListener("abort",()=>void i(o.Left(new Error("Failed to request a page by abort.")))),h.addEventListener("error",()=>void i(o.Left(new Error("Failed to request a page by error.")))),h.addEventListener("timeout",()=>void i(o.Left(new Error("Failed to request a page by timeout.")))),h.addEventListener("load",()=>void function(e,t){return o.Right(e).bind(e=>{const n=new u.URL(u.standardize(e.responseURL));switch(!0){case!e.responseURL:return o.Left(new Error("Failed to get the response URL."));case n.origin!==new u.URL(window.location.origin).origin:return o.Left(new Error("Redirected to another origin."));case!/2..|304/.test(`${e.status}`):return o.Left(new Error("Failed to validate the status of response."));case!e.response:return"GET"===t&&304===e.status&&l.has(n.path)?o.Right(l.get(n.path).xhr):o.Left(new Error("Failed to get the response body."));case!d(e.getResponseHeader("Content-Type"),"text/html"):return o.Left(new Error("Failed to validate the content type of response."));default:return o.Right(e)}})}(h,e).fmap(t=>{const n=new u.URL(u.standardize(t.responseURL));if("GET"===e){const e=new Map(t.getResponseHeader("Cache-Control")?t.getResponseHeader("Cache-Control").trim().split(/\s*,\s*/).filter(e=>e.length>0).map(e=>e.split("=").concat("")):[]);for(const r of new Set([m.path,n.path]))t.getResponseHeader("ETag")&&!e.has("no-store")?l.set(r,{etag:t.getResponseHeader("ETag"),expiry:e.has("max-age")&&!e.has("no-cache")&&Date.now()+1e3*+e.get("max-age")||0,xhr:t}):l.delete(r)}return(e,i)=>new r.FetchResponse(n.path===i.path?e:i.path!==m.path&&v?e:n,t)}).fmap(e=>(v&&a.set(v,e),e(t,m))).extract(e=>void i(o.Left(e)),e=>void i(o.Right(e)))),p.register(()=>void h.abort())})},n.match_=d},{"../../model/eav/value/fetch":108,"spica/cache":5,"spica/either":13,"spica/promise":80,"spica/sequence":81,"spica/url":88}],111:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function c(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,c)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});const i=e("../../event/router"),s=e("../module/update/blur"),o=e("../module/update/url"),c=e("../module/update/title"),u=e("../module/update/head"),a=e("../module/update/content"),l=e("../module/update/css"),d=e("../module/update/script"),h=e("../module/update/focus"),f=e("../module/update/scroll"),p=e("../../store/path"),m=e("spica/promise"),v=e("spica/either"),y=e("spica/hlist");n.update=function({event:e,config:t,state:n},b,w,g){const{process:q}=n,S={src:b.document,dst:g.document};return m.AtomicPromise.resolve(w).then(q.either).then(e=>e.bind(()=>a.separate(S,t.areas).extract(()=>v.Left(new Error("Failed to separate the areas.")),()=>e)).fmap(e=>(window.dispatchEvent(new Event("pjax:unload")),t.sequence.unload(e,Object.assign(Object.assign({},b),{url:b.url.reference}))))).then(e=>v.Either.sequence(e)).then(q.promise).then(e=>e.bind(e=>a.separate(S,t.areas).fmap(([t])=>[e,t]).extract(()=>v.Left(new Error("Failed to separate the areas.")),q.either)).bind(([e,n])=>(t.update.rewrite(S.src,n),a.separate(S,t.areas).fmap(([,t])=>[e,t]).extract(()=>v.Left(new Error("Failed to separate the areas.")),q.either)))).then(q.promise).then(w=>w.fmap(([w,_])=>y.HNil.extend(()=>(s.blur(S.dst),o.url(new i.RouterEventLocation(b.url),S.src.title,e.type,e.source,t.replace),c.title(S),p.saveTitle(),u.head(S,t.update.head,t.update.ignore),q.either(a.content(S,_)).fmap(([e,t])=>[e,m.AtomicPromise.all(t)]))).extend(i=>r(this,void 0,void 0,function*(){return(yield i).fmap(([i])=>r(this,void 0,void 0,function*(){t.update.css&&l.css(S,t.update.ignore),g.document.dispatchEvent(new Event("pjax:content"));const r=yield t.sequence.content(w,i),s=t.update.script?yield d.script(S,n.scripts,t.update,10*Math.max(t.fetch.timeout,1e3),q):yield q.either([[],m.AtomicPromise.resolve(q.either([]))]);return h.focus(e.type,S.dst),f.scroll(e.type,S.dst,{hash:e.location.dest.fragment,position:g.position}),p.savePosition(),g.document.dispatchEvent(new Event("pjax:ready")),[s.fmap(([e,t])=>[e,t.then(e=>e.extract())]),yield t.sequence.ready(r)]})).fmap(e=>e.then(([e,t])=>e.fmap(e=>[e,t]))).extract(e=>m.AtomicPromise.resolve(v.Left(e)))})).reverse())).then(q.promise).then(e=>e.fmap(([e,n])=>(m.AtomicPromise.all([e,n]).then(([e,n])=>e.bind(([,e])=>n.fmap(([[,n],r])=>void m.AtomicPromise.all([e,n]).then(q.either).then(e=>e.fmap(([e])=>(window.dispatchEvent(new Event("pjax:load")),void t.sequence.load(r,e))).extract(()=>void 0)))).extract(()=>void 0)),n))).then(e=>v.Either.sequence(e).then(e=>e.join())).then(e=>e.fmap(([e])=>e))}},{"../../event/router":105,"../../store/path":122,"../module/update/blur":112,"../module/update/content":113,"../module/update/css":114,"../module/update/focus":115,"../module/update/head":116,"../module/update/script":117,"../module/update/scroll":118,"../module/update/title":120,"../module/update/url":121,"spica/either":13,"spica/hlist":19,"spica/promise":80}],112:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.blur=function(e){e===window.document&&e.activeElement!==e.body&&(e.activeElement.blur(),e.body.focus())}},{}],113:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./script"),i=e("spica/promise"),s=e("spica/maybe"),o=e("spica/concat"),c=e("typed-dom");function u(e){return(e.match(/(?:[^,\(\[]+|\(.*?\)|\[.*?\])+/g)||[]).map(e=>e.trim()).reduce((e,t)=>t?e.fmap(e=>o.concat(e,[t])):s.Nothing,s.Just([]))}function a(e){return i.AtomicPromise.race([new i.AtomicPromise(t=>void c.once(e,"load",t)),new i.AtomicPromise(t=>void c.once(e,"abort",t)),new i.AtomicPromise(t=>void c.once(e,"error",t))])}n.content=function(e,t,n={replace:(e,t)=>void t.parentNode.replaceChild(e,t)}){return[t.map(e=>e.dst).reduce(o.concat,[]),t.map(function(t){return t.src.map((n,r)=>({src:e.dst.importNode(t.src[r].cloneNode(!0),!0),dst:t.dst[r]})).map(e=>(!function(e){const t=[...c.apply(e.src,"script")].map(r.escape).reduce((e,t)=>()=>(e(),void t()),()=>void 0);n.replace(e.src,e.dst),t()}(e),[...c.apply(e.src,"img, iframe, frame")].map(a))).reduce(o.concat,[])}).reduce(o.concat,[])]},n.separate=function(e,t){return t.reduce((t,n)=>s.Maybe.mplus(t,function(e,t){return u(t).bind(t=>t.reduce((t,n)=>t.bind(t=>{const r={src:[...c.apply(e.src,n)],dst:[...c.apply(e.dst,n)]};return r.src.length>0&&r.src.length===r.dst.length?s.Just(o.concat(t,[r])):s.Nothing}),s.Just([])))}(e,n).fmap(e=>[n,e])),s.Nothing)},n._split=u,n._wait=a},{"./script":117,"spica/concat":10,"spica/maybe":20,"spica/promise":80,"typed-dom":91}],114:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./sync"),i=e("typed-dom");n.css=function(e,t){const n='link[rel~="stylesheet"], style';return void["head","body"].map(t=>[e.src.querySelector(t),e.dst.querySelector(t)]).forEach(([e,t])=>void r.sync(r.pair(s(e),s(t),(e,t)=>e.outerHTML===t.outerHTML),t));function s(e){return[...i.apply(e,n)].filter(e=>!t||!e.matches(t))}}},{"./sync":119,"typed-dom":91}],115:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../../event/router"),i=e("typed-dom");n.focus=function(e,t){switch(e){case r.RouterEventType.click:case r.RouterEventType.submit:return void[...i.apply(t,"[autofocus]")].slice(-1).filter(e=>e.closest("html")===window.document.documentElement&&e!==t.activeElement).forEach(e=>void e.focus());case r.RouterEventType.popstate:return;default:throw new TypeError(e)}}},{"../../../event/router":105,"typed-dom":91}],116:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./sync"),i=e("typed-dom");n.head=function(e,t,n){return n+=t.includes("link")?', link[rel~="stylesheet"]':"",void r.sync(r.pair(s(e.src.head),s(e.dst.head),(e,t)=>e.outerHTML===t.outerHTML),e.dst.head);function s(e){return[...i.apply(e,t)].filter(e=>!n||!e.matches(n))}}},{"./sync":119,"typed-dom":91}],117:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function c(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,c)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});const i=e("../../../../../lib/error"),s=e("spica/promise"),o=e("spica/either"),c=e("spica/url"),u=e("spica/tuple"),a=e("spica/concat"),l=e("spica/clock"),d=e("typed-dom");function h(e,t){return r(this,void 0,void 0,function*(){return e.hasAttribute("src")?"module"===e.type.toLowerCase()?o.Right([e,""]):s.AtomicPromise.race([window.fetch(e.src,{headers:new Headers({Accept:"application/javascript"}),integrity:e.integrity}),l.wait(t).then(()=>s.AtomicPromise.reject(new Error(`${e.src}: Timeout.`)))]).then(t=>r(this,void 0,void 0,function*(){return t.ok?o.Right([e,yield t.text()]):e.matches("[src][async]")?m(e).then(()=>o.Right([e,""]),()=>o.Left(new Error(`${e.src}: ${t.statusText}`))):o.Left(new Error(t.statusText))}),e=>o.Left(e)):o.Right([e,e.text])})}function f(t,n,r,u,a,l){const d=!!(t=t.ownerDocument===document?t:document.importNode(t.cloneNode(!0),!0)).parentElement&&t.parentElement.matches(r.trim()||"_"),h=document.querySelector(d?t.parentElement.id?`#${t.parentElement.id}`:t.parentElement.tagName:"_")||document.body,f=p(t);h.appendChild(t),f(),!d&&t.remove();const v=s.AtomicPromise.resolve(a).then(function(){if(l.canceled)throw new i.FatalError("Expired.");if(t.matches('[type="module"][src]'))return s.AtomicPromise.resolve(Promise.resolve().then(()=>e(t.src))).catch(e=>e.message.startsWith("Failed to load ")&&t.matches("[src][async]")?m(t).catch(()=>s.AtomicPromise.reject(e)):s.AtomicPromise.reject(e)).then(()=>(t.dispatchEvent(new Event("load")),o.Right(t)),e=>(t.dispatchEvent(new Event("error")),o.Left(new i.FatalError(e instanceof Error?e.message:e+""))));try{if(u.has(new c.URL(c.standardize(window.location.href)).reference))throw new i.FatalError("Expired.");return(0,eval)(n),t.hasAttribute("src")&&t.dispatchEvent(new Event("load")),s.AtomicPromise.resolve(o.Right(t))}catch(e){return t.hasAttribute("src")&&t.dispatchEvent(new Event("error")),s.AtomicPromise.resolve(o.Left(new i.FatalError(e instanceof Error?e.message:e+"")))}});return t.matches("[src][async]")?o.Right(v):o.Left(v)}function p(e){const t=e.hasAttribute("src")?e.getAttribute("src"):null,n=e.text;return e.removeAttribute("src"),e.text="",()=>(e.text=" ",e.text=n,"string"==typeof t?void e.setAttribute("src",t):void 0)}function m(e){return new c.URL(c.standardize(e.src)).origin===new c.URL(c.standardize(window.location.href)).origin?s.AtomicPromise.reject(new Error):(e=d.html("script",Object.values(e.attributes).reduce((e,{name:t,value:n})=>(e[t]=n,e),{}),[...e.childNodes]),new s.AtomicPromise((t,n)=>(e.addEventListener("load",()=>void t()),e.addEventListener("error",n),document.body.appendChild(e),void e.remove())))}n.script=function(e,t,n,i,l,p={fetch:h,evaluate:f}){const m=[...d.apply(e.src,"script")].filter(e=>!e.type||/(?:application|text)\/(?:java|ecma)script|module/i.test(e.type)).filter(e=>!e.matches(n.ignore.trim()||"_")).filter(e=>!e.hasAttribute("src")||!t.has(new c.URL(c.standardize(e.src)).reference)||e.matches(n.reload.trim()||"_")),{ss:v,as:y}=m.reduce((e,t)=>{switch(!0){case t.matches("[src][async], [src][defer]"):e.as.push(t);break;default:e.ss.push(t)}return e},{ss:[],as:[]});return s.AtomicPromise.all([s.AtomicPromise.all(b(v)).then(w),s.AtomicPromise.all(b(y)).then(w)]).then(([e,t])=>r(this,void 0,void 0,function*(){return e.fmap(e=>r(this,void 0,void 0,function*(){return(yield e).fmap(([e,n])=>[e,n.then(e=>r(this,void 0,void 0,function*(){return t.fmap(t=>r(this,void 0,void 0,function*(){return(yield t).fmap(([t,n])=>s.AtomicPromise.all([e,o.Right(t),n]).then(e=>e.reduce((e,t)=>e.bind(e=>t.fmap(t=>a.concat(e,t)))))).extract(o.Left)})).extract(o.Left)}))])})).extract(o.Left)}));function b(e){return e.map(e=>p.fetch(e,i))}function w(e){return e.reduce((e,t)=>t.bind(()=>e),e.reduce((e,r)=>e.bind(l.either).bind(([e,i])=>r.fmap(([r,i])=>p.evaluate(r,i,n.logger,t,s.AtomicPromise.all(e),l)).bind(t=>t.extract(t=>o.Right(u.tuple([a.concat(e,[t]),i])),t=>o.Right(u.tuple([e,a.concat(i,[t])]))))),o.Right([[],[]]))).fmap(([e,t])=>s.AtomicPromise.all(e).then(e=>o.Either.sequence(e)).then(e=>e.fmap(e=>u.tuple([e,Promise.all(t).then(e=>o.Either.sequence(e))]))))}},n._fetch=h,n._evaluate=f,n.escape=p},{"../../../../../lib/error":136,"spica/clock":8,"spica/concat":10,"spica/either":13,"spica/promise":80,"spica/tuple":85,"spica/url":88,"typed-dom":91}],118:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../../event/router");function i(e,t,n={scrollToElement:e=>void e.scrollIntoView()}){const r=t.slice(1);if(0===r.length)return!1;const i=e.getElementById(r)||e.getElementsByName(r)[0];return!!i&&(n.scrollToElement(i),!0)}n.scroll=function(e,t,n,s={scrollToElement:e=>void e.scrollIntoView(),scrollToPosition:({top:e,left:t})=>void window.scrollTo(t,e),hash:i}){switch(e){case r.RouterEventType.click:if(s.hash(t,n.hash,s))return;return void s.scrollToPosition({top:0,left:0});case r.RouterEventType.submit:return void s.scrollToPosition({top:0,left:0});case r.RouterEventType.popstate:return void s.scrollToPosition(n.position());default:throw new TypeError(e)}},n._hash=i},{"../../../event/router":105}],119:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("spica/either"),i=e("spica/concat");function s(e,t,n){t.map(t=>e.ownerDocument.importNode(t.cloneNode(!0),!0)).forEach(t=>void e.insertBefore(t,n))}function o(e){e.remove()}n.sync=function(e,t,n={before:s,remove:o}){return void e.forEach(([e,r])=>(n.before(function(e){return e?e.parentElement:t}(r),e.slice(-1).some(e=>!!r&&e.outerHTML===r.outerHTML)?e.slice(0,-1):e,r),r&&0===e.length?void n.remove(r):void 0))},n.pair=function(e,t,n){const s=function(e,t,n){return e.reduce((e,s)=>0===t.length?e.set(null,i.concat(e.get(null)||[],[s])):t.reduce((e,t)=>e.bind(e=>!e.has(t)&&n(s,t)?(e.set(t,i.concat(e.get(null)||[],[s])),e.delete(null),r.Left(e)):r.Right(e)),r.Right(e)).fmap(e=>e.set(null,i.concat(e.get(null)||[],[s]))).extract(e=>e),new Map)}(e,t,n);return t.filter(e=>!s.has(e)).forEach(e=>void s.set(e,[])),[...s].map(([e,t])=>[t,e])}},{"spica/concat":10,"spica/either":13}],120:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.title=function(e){e.dst.title=e.src.title}},{}],121:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../../event/router");function i(e,t){if(t.dest.reference===t.orig.reference)return!1;switch(e){case r.RouterEventType.click:case r.RouterEventType.submit:return!0;case r.RouterEventType.popstate:return!1;default:throw new TypeError(e)}}function s(e,t,n){switch(e){case r.RouterEventType.click:case r.RouterEventType.submit:return t.matches(n.trim()||"_");case r.RouterEventType.popstate:return!1;default:throw new TypeError(e)}}e("typed-dom").bind(document,"pjax:ready",()=>void window.history.replaceState(window.history.state,window.document.title)),n.url=function(e,t,n,r,o){switch(!0){case s(n,r,o):return void window.history.replaceState({},t,e.dest.reference);case i(n,e):return void window.history.pushState({},t,e.dest.reference);default:return}},n._isRegisterable=i,n._isReplaceable=s},{"../../../event/router":105,"typed-dom":91}],122:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}(e("../../data/store/state"))},{"../../data/store/state":102}],123:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("spica/coroutine"),i=e("typed-dom");n.ClickView=class extends r.Coroutine{constructor(e,t,n){super(function*(){return this.finally(i.delegate(e,t,"click",e=>{e.currentTarget instanceof HTMLAnchorElement&&"string"==typeof e.currentTarget.href&&n(e)}))}),this[r.Coroutine.init]()}}},{"spica/coroutine":11,"typed-dom":91}],124:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../service/state/url"),i=e("spica/coroutine"),s=e("spica/url"),o=e("typed-dom");n.NavigationView=class extends i.Coroutine{constructor(e,t){super(function*(){return this.finally(o.bind(e,"popstate",n=>{s.standardize(e.location.href)!==r.docurl.href&&t(n)}))}),this[i.Coroutine.init]()}}},{"../../service/state/url":134,"spica/coroutine":11,"spica/url":88,"typed-dom":91}],125:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../service/state/url"),i=e("spica/coroutine"),s=e("spica/url"),o=e("spica/throttle"),c=e("typed-dom");n.ScrollView=class extends i.Coroutine{constructor(e,t){super(function*(){return this.finally(c.bind(e,"scroll",o.debounce(100,n=>{new URL(s.standardize(e.location.href)).href===r.docurl.href&&t(n)}),{passive:!0}))}),this[i.Coroutine.init]()}}},{"../../service/state/url":134,"spica/coroutine":11,"spica/throttle":84,"spica/url":88,"typed-dom":91}],126:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("spica/coroutine"),i=e("typed-dom");n.SubmitView=class extends r.Coroutine{constructor(e,t,n){super(function*(){return this.finally(i.delegate(e,t,"submit",e=>{e.currentTarget instanceof HTMLFormElement&&n(e)}))}),this[r.Coroutine.init]()}}},{"spica/coroutine":11,"typed-dom":91}],127:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./router"),i=e("./state/process"),s=e("../../../lib/html"),o=e("spica/assign"),c=e("typed-dom");function u(e,t){const n=document.createElement("a");n.href=e,s.parse("").extract().body.appendChild(n),c.once(n,"click",t),c.once(n,"click",e=>void e.preventDefault()),n.click()}n.API=class{static assign(e,t,n={document:window.document,router:r.route}){let s;return u(e,e=>s=n.router(new r.Config(t),new r.RouterEvent(e),i.process,n)),s}static replace(e,t,n={document:window.document,router:r.route}){let s;return u(e,e=>s=n.router(new r.Config(o.extend({},t,{replace:"*"})),new r.RouterEvent(e),i.process,n)),s}}},{"../../../lib/html":137,"./router":129,"./state/process":131,"spica/assign":4,"typed-dom":91}],128:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./api"),i=e("../module/view/click"),s=e("../module/view/submit"),o=e("../module/view/navigation"),c=e("../module/view/scroll"),u=e("./router");e("./state/scroll-restoration");const a=e("./state/process"),l=e("../../application/store"),d=e("spica/supervisor");n.GUI=class extends r.API{constructor(e,t={document:window.document,router:u.route}){super(),this.option=e,this.io=t,new h(this.option,t)}assign(e){return r.API.assign(e,this.option,this.io)}replace(e){return r.API.replace(e,this.option,this.io)}};class h{constructor(e,t){const n=new u.Config(e),r=e=>void t.router(n,new u.RouterEvent(e),a.process,t);[new i.ClickView(t.document,n.link,r),new s.SubmitView(t.document,n.form,r),new o.NavigationView(window,r),new c.ScrollView(window,l.savePosition)].forEach((e,t)=>void h.resource.kill(`${t}`)||void h.resource.register(`${t}`,e))}}h.resource=new class extends d.Supervisor{},n.clear=function(){h.resource.clear()}},{"../../application/store":101,"../module/view/click":123,"../module/view/navigation":124,"../module/view/scroll":125,"../module/view/submit":126,"./api":127,"./router":129,"./state/process":131,"./state/scroll-restoration":133,"spica/supervisor":83}],129:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function c(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,c)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});const i=e("../../application/router");n.Config=i.Config,n.RouterEvent=i.RouterEvent,n.RouterEventSource=i.RouterEventSource;const s=e("./state/url"),o=e("../service/state/env"),c=e("../../../lib/error"),u=e("../../application/store"),a=e("spica/url"),l=e("spica/cancellation"),d=e("spica/maybe"),h=e("spica/clock");function f(e,t,n){if(n.original.defaultPrevented)return!1;switch(n.type){case i.RouterEventType.click:return o(e)&&(r=e,!(new a.URL(s.docurl.href).resource===r.resource&&""!==r.fragment))&&!p(e)&&!n.source.hasAttribute("download")&&!function(e){return e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey}(n.original)&&t.filter(n.source);case i.RouterEventType.submit:return o(e);case i.RouterEventType.popstate:return o(e)&&!p(e);default:return!1}var r;function o(e){return new a.URL(s.docurl.href).origin===e.origin}}function p(e){const t=new a.URL(s.docurl.href);return t.resource===e.resource&&t.fragment!==e.fragment}e("typed-dom").bind(window,"pjax:unload",()=>window.history.scrollRestoration="auto",!0),n.route=function(e,t,n,m){switch(t.type){case i.RouterEventType.click:case i.RouterEventType.submit:u.savePosition();break;case i.RouterEventType.popstate:m.document.title=u.loadTitle()}return d.Just(0).guard(f(t.request.url,e,t)).bind(()=>i.scope(e,(({orig:e,dest:t})=>({orig:e.pathname,dest:t.pathname}))(t.location))).fmap(e=>r(this,void 0,void 0,function*(){t.original.preventDefault(),n.cast("",new Error("Aborted."));const u=new l.Cancellation,d=n.register("",e=>(d(),u.cancel(e),h.never)),[f]=yield o.env;return window.history.scrollRestoration="manual",i.route(e,t,{process:u,scripts:f},m).then(e=>e.fmap(([e,t])=>r(this,void 0,void 0,function*(){return d(),s.docurl.sync(),e.filter(e=>e.hasAttribute("src")).forEach(e=>void f.add(new a.URL(a.standardize(e.src)).reference)),void(yield t).filter(e=>e.hasAttribute("src")).forEach(e=>void f.add(new a.URL(a.standardize(e.src)).reference))})).extract()).catch(n=>(d(),s.docurl.sync(),window.history.scrollRestoration="auto",!u.canceled||n instanceof c.FatalError?void e.fallback(t.source,n):void 0))})).extract(()=>{switch(n.cast("",new Error("Aborted.")),t.type){case i.RouterEventType.click:case i.RouterEventType.submit:return s.docurl.sync(),!1;case i.RouterEventType.popstate:return p(t.location.dest)?(s.docurl.sync(),!1):(e.fallback(t.source,new Error("Disabled.")),s.docurl.sync(),!0)}},()=>!0)},n._validate=f},{"../../../lib/error":136,"../../application/router":100,"../../application/store":101,"../service/state/env":130,"./state/url":134,"spica/cancellation":6,"spica/clock":8,"spica/maybe":20,"spica/url":88,"typed-dom":91}],130:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./script");n.env=Promise.all([r.scripts,new Promise(e=>void setTimeout(e))])},{"./script":132}],131:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("spica/supervisor");n.process=new class extends r.Supervisor{}},{"spica/supervisor":83}],132:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("spica/url"),i=e("typed-dom");n.scripts=new Set,i.bind(window,"pjax:unload",()=>void i.apply(document,"script[src]").forEach(e=>void n.scripts.add(new r.URL(r.standardize(e.src)).reference)))},{"spica/url":88,"typed-dom":91}],133:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),e("typed-dom").bind(window,"unload",()=>window.history.scrollRestoration="auto",!1)},{"typed-dom":91}],134:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("spica/url");e("typed-dom").bind(window,"hashchange",()=>void n.docurl.sync()),n.docurl=new class{constructor(){this.url=r.standardize(window.location.href)}get href(){return this.url}sync(){this.url=r.standardize(window.location.href)}}},{"spica/url":88,"typed-dom":91}],135:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.serialize=function(e){return Array.from(e.elements).filter(e=>{if(e.disabled)return!1;switch(e.nodeName.toLowerCase()){case"input":switch(e.type.toLowerCase()){case"checkbox":case"radio":return e.checked;case"submit":case"button":case"image":case"reset":case"file":return!1;default:return!0}case"select":case"textarea":return!0;default:return!1}}).filter(e=>"string"==typeof e.name&&"string"==typeof e.value).map(e=>[encodeURIComponent(t(e.name)),encodeURIComponent(t(e.value))].join("=")).join("&");function t(e){return e.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]?|[\uDC00-\uDFFF]/g,e=>2===e.length?e:"")}}},{}],136:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});class r extends Error{constructor(e){super(e)}}n.FatalError=r,Error.prototype.name="Error",r.prototype.name="FatalError"},{}],137:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("spica/maybe"),i=e("spica/either"),s=e("typed-dom");function o(e){c(e).forEach(([e,t])=>e.textContent=t.textContent)}function c(e){return[...s.apply(e,"noscript")].filter(e=>e.children.length>0).map(e=>{const t=e.cloneNode(!0);return t.textContent=e.innerHTML,[e,t]})}n.parse=[function(e){const t=(new DOMParser).parseFromString(e,"text/html");return o(t),t},function(e){const t=window.document.implementation.createHTMLDocument("");return t.open(),t.write(e),t.close(),o(t),t}].reduce((e,t)=>e.bind(()=>!function(e){try{const t='\n<html lang="en" class="html">\n  <head>\n    <link href="/">\n    <title>&amp;</title>\n    <noscript><style>/**/</style></noscript>\n  </head>\n  <body>\n    <noscript>noscript</noscript>\n    <a href="/"></a>\n    <script>document.head.remove();<\/script>\n    <img src="abc">\n  </body>\n</html>\n',n=e(t);switch(!1){case"&"===n.title:case!!n.querySelector('html.html[lang="en"]'):case!!n.querySelector("head > link").href:case!!n.querySelector("body > a").href:case!n.querySelector("head > noscript > *"):case"document.head.remove();"===n.querySelector("script").innerHTML:case n.querySelector("img").src.endsWith("abc"):case"<style>/**/</style>"===n.querySelector("head > noscript").textContent:case"noscript"===n.querySelector("body > noscript").textContent:throw void 0}return!0}catch(e){return!1}}(t)?e:i.Left(t)),i.Right(()=>r.Nothing)).extract(e=>t=>r.Just(e(t))),n.fix=o,n._fixNoscript=c},{"spica/either":13,"spica/maybe":20,"typed-dom":91}],138:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("spica/url"),i=e("spica/sequence"),s=e("spica/curry"),o=e("spica/flip"),c=e("spica/cache");function u(e,t){const n=/\/|[^/]+\/?/g,r=/\/$/;return i.Sequence.zip(i.Sequence.from(a(e)),i.Sequence.cycle([t])).map(([e,t])=>[e.match(n)||[],e.match(r)?t.match(n)||[]:t.replace(r,"").match(n)||[]]).filter(([e,t])=>e.length<=t.length&&0===i.Sequence.zip(i.Sequence.from(e),i.Sequence.from(t)).dropWhile(([e,t])=>d(e,t)).take(1).extract().length).take(1).extract().length>0}function a(e){if(e.match(/\*\*|[\[\]]/))throw new Error(`Invalid pattern: ${e}`);return""===e?[e]:i.Sequence.from(e.match(/{[^{}]*}|.[^{]*/g)).map(e=>e.match(/^{[^{}]*}$/)?e.slice(1,-1).split(","):[e]).mapM(i.Sequence.from).map(e=>e.join("")).bind(t=>t===e?i.Sequence.from([t]):i.Sequence.from(a(t))).unique().extract()}n.router=function(e){return t=>{const{path:n,pathname:c}=new r.URL(r.standardize(t));return i.Sequence.from(Object.keys(e).filter(([e])=>"/"===e).sort().reverse()).filter(s.curry(o.flip(u))(c)).map(t=>e[t]).take(1).extract().pop().call(e,n)}},n.compare=u,n._expand=a;const l=new c.Cache(100);function d(e,t){if("."===t[0]&&[..."?*"].includes(e[0]))return!1;const n=`${e}:${t}`;return l.has(n)?l.get(n):l.set(n,function e(t,n){const[r="",...s]=[...t];const[o="",...c]=[...n];switch(r){case"":return""===o;case"?":return""!==o&&"/"!==o&&e(s.join(""),c.join(""));case"*":return"/"===o?e(s.join(""),n):i.Sequence.zip(i.Sequence.cycle([s.join("")]),i.Sequence.from(n).tails().map(e=>e.join(""))).filter(([t,n])=>e(t,n)).take(1).extract().length>0;default:return o===r&&e(s.join(""),c.join(""))}}(function e(t){const n=t.replace(/\*(\?+)\*?/g,"$1*");return n===t?n:e(n)}(e),t))}n._match=d},{"spica/cache":5,"spica/curry":12,"spica/flip":16,"spica/sequence":81,"spica/url":88}],"pjax-api":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}(e("./src/export"));var r=e("./src/export");n.default=r.default},{"./src/export":99}]},{},[1,2,3,"pjax-api"]),function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports&&(module.exports=t())}("undefined"!=typeof self&&self,function(){return require("pjax-api")});